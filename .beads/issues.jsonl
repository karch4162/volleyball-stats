{"id":"volleyball-stats-4v4","title":"Test with fresh daemon","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T19:27:55.1331369-05:00","created_by":"Mason Beard","updated_at":"2026-01-01T19:30:32.5810076-05:00","deleted_at":"2026-01-01T19:30:32.5810076-05:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"volleyball-stats-a39","title":"Test beads sync workflow","description":"This is a test issue to verify beads-sync branch integration","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T19:22:46.8301395-05:00","created_by":"Mason Beard","updated_at":"2026-01-01T19:25:37.1709156-05:00","deleted_at":"2026-01-01T19:25:37.1709156-05:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"volleyball-stats-ao7","title":"Test issue to verify sync","description":"This is a test issue to verify beads-sync worktree functionality","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T15:25:01.4170761-05:00","created_by":"Mason Beard","updated_at":"2026-01-02T15:25:01.4170761-05:00"}
{"id":"volleyball-stats-b4v","title":"Match Setup Wizard Improvements","description":"Streamline the match setup wizard by introducing roster templates, quick-start options, and a more flexible single-screen UI that reduces repetitive manual selection.\n\n## Pain Points Addressed\n- Repetitive player selection every match\n- Rigid 4-step stepper flow\n- Tedious rotation assignment (6 dropdowns)\n- No quick start from previous match\n- No saved roster templates\n\n## Goals\n1. Roster Template System - Save and reuse common lineup configurations\n2. Quick Start Options - Clone last match or use template\n3. Single-Screen Setup - Replace stepper with flexible scrollable view\n4. Visual Rotation Grid - Drag-drop instead of dropdowns\n5. Auto-Save Drafts - Never lose work in progress\n\n## Success Metrics\n- Time to setup: \u003c1 minute (with template) vs current 3-5 minutes\n- 80% template adoption within 5 matches\n- 60%+ quick start usage\n\n## Reference\nSee agent-docs/features/match-setup/improvement-plan.md for full specification","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-30T22:46:09.5602889-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:46:09.5602889-05:00"}
{"id":"volleyball-stats-b4v.1","title":"Roster Template System","description":"## Objective\nAllow coaches to save and reuse common roster configurations (player selections + optional default rotation).\n\n## Tasks\n- [ ] Create `RosterTemplate` model with fields: id, name, description, playerIds, defaultRotation, createdAt, lastUsedAt, useCount\n- [ ] Extend repository with template CRUD methods: save, load, delete, updateUsage\n- [ ] Create Supabase migration for `roster_templates` table\n- [ ] Create template management UI (list screen with grid/list of templates)\n- [ ] Add \"Save as Template\" option to match setup flow\n- [ ] Implement template picker modal\n\n## Data Model\n```dart\nclass RosterTemplate {\n  final String id;\n  final String name;\n  final String? description;\n  final Set\u003cString\u003e playerIds;\n  final Map\u003cint, String\u003e defaultRotation; // Optional: 1-6 positions\n  final DateTime createdAt;\n  final DateTime? lastUsedAt;\n  final int useCount;\n}\n```\n\n## Database Schema\n```sql\nCREATE TABLE roster_templates (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  team_id UUID REFERENCES teams(id),\n  name TEXT NOT NULL,\n  description TEXT,\n  player_ids TEXT[] NOT NULL,\n  default_rotation JSONB,\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  last_used_at TIMESTAMPTZ,\n  use_count INT DEFAULT 0\n);\n```\n\n## Files to Create\n- `lib/features/match_setup/models/roster_template.dart`\n- `lib/features/match_setup/widgets/template_list_screen.dart`\n- `lib/features/match_setup/widgets/template_picker_modal.dart`\n- `supabase/migrations/0007_roster_templates.sql`\n\n## Files to Modify\n- `lib/features/match_setup/data/match_setup_repository.dart` - Add template methods\n- Repository implementations (Supabase, offline, cached)\n\n## Acceptance Criteria\n- [ ] Can create new templates from match setup\n- [ ] Can view list of saved templates\n- [ ] Can edit/delete existing templates\n- [ ] Can select template to pre-fill roster\n- [ ] Templates persist offline\n- [ ] Templates sync to Supabase when online","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:47:28.3338284-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:47:28.3338284-05:00","dependencies":[{"issue_id":"volleyball-stats-b4v.1","depends_on_id":"volleyball-stats-b4v","type":"parent-child","created_at":"2025-12-30T22:47:28.3472206-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-b4v.2","title":"Quick Start Options","description":"## Objective\nAdd a landing screen with quick start options before entering match setup, reducing setup time for common scenarios.\n\n## Tasks\n- [ ] Build `MatchSetupLandingScreen` with 3 quick start options\n- [ ] Implement \"Use Last Match\" flow (clone most recent match draft)\n- [ ] Implement \"Use Template\" flow (show template picker, pre-fill)\n- [ ] Update navigation to use landing screen as entry point\n- [ ] Add \"Recent Drafts\" section showing incomplete matches\n\n## Quick Start Options\n1. **Use Last Match Setup** - Clone previous match (pre-fill all fields)\n2. **Use Template** - Select saved roster template\n3. **Start Fresh** - Current empty flow\n\n## Files to Create\n- `lib/features/match_setup/match_setup_landing_screen.dart`\n\n## Files to Modify\n- `lib/features/match_setup/providers.dart` - Add `lastMatchDraftProvider`\n- `lib/core/router/app_router.dart` - Update navigation flow\n- Home screen - Update \"New Match\" to navigate to landing\n\n## UI Design\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Start New Match                    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Quick Start Options:               â”‚\nâ”‚                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ ğŸ“‹ Use Last Match Setup     â”‚    â”‚\nâ”‚  â”‚ Clone your previous match   â”‚    â”‚\nâ”‚  â”‚ [Last used: 2 days ago]     â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ â­ Use Template             â”‚    â”‚\nâ”‚  â”‚ Choose from saved rosters   â”‚    â”‚\nâ”‚  â”‚ [3 templates available]     â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ âœï¸ Start Fresh              â”‚    â”‚\nâ”‚  â”‚ Build from scratch          â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                     â”‚\nâ”‚  Recent Drafts                      â”‚\nâ”‚  â€¢ vs Eagles (Mar 10) - Incomplete  â”‚\nâ”‚  â€¢ vs Tigers (Mar 8) - Complete     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Provider\n```dart\nfinal lastMatchDraftProvider = FutureProvider\u003cMatchDraft?\u003e((ref) async {\n  final repo = ref.read(matchSetupRepositoryProvider);\n  return await repo.loadMostRecentDraft(teamId: defaultTeamId);\n});\n```\n\n## Acceptance Criteria\n- [ ] Landing screen displays before match setup\n- [ ] \"Use Last Match\" pre-fills all fields from previous match\n- [ ] \"Use Template\" opens template picker and pre-fills roster\n- [ ] \"Start Fresh\" enters empty match setup\n- [ ] Recent drafts section shows incomplete matches\n- [ ] Tapping incomplete draft resumes setup","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:47:29.9855831-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:47:29.9855831-05:00","dependencies":[{"issue_id":"volleyball-stats-b4v.2","depends_on_id":"volleyball-stats-b4v","type":"parent-child","created_at":"2025-12-30T22:47:30.0025557-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-b4v.2","depends_on_id":"volleyball-stats-b4v.1","type":"blocks","created_at":"2025-12-30T22:47:44.5767705-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-b4v.3","title":"Single-Screen Match Setup UI","description":"## Objective\nReplace the rigid 4-step stepper with a single scrollable screen that groups related fields and provides a more flexible workflow.\n\n## Tasks\n- [ ] Replace stepper with single scrollable screen layout\n- [ ] Implement visual rotation grid (tap position to assign player)\n- [ ] Add progressive inline validation (errors next to fields)\n- [ ] Add smart suggestions (auto-assign rotation when 6 selected)\n- [ ] Allow saving incomplete drafts anytime\n- [ ] Update styling to match dark theme\n\n## Current Flow (Stepper)\n1. Match Metadata Step\n2. Roster Selection Step\n3. Rotation Setup Step\n4. Summary Step\n\n## New Flow (Single Screen)\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚  Match Setup                        â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚  Match Info                    âœ“    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ Opponent: [___________]     â”‚    â”‚\nâ”‚  â”‚ Date: [Mar 15, 2024] ğŸ“…     â”‚    â”‚\nâ”‚  â”‚ Location: [___________]     â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                     â”‚\nâ”‚  Quick Actions                      â”‚\nâ”‚  [Use Template â–¼] [Clone Last]      â”‚\nâ”‚                                     â”‚\nâ”‚  Roster Selection           6/12    â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚ â˜‘ #2 Avery (Setter)        â”‚    â”‚\nâ”‚  â”‚ â˜‘ #5 Bailey (Opposite)     â”‚    â”‚\nâ”‚  â”‚ ...                        â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                     â”‚\nâ”‚  Starting Rotation            âœ“     â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚\nâ”‚  â”‚      [1]    [2]    [3]     â”‚    â”‚\nâ”‚  â”‚      #2     #5     #11     â”‚    â”‚\nâ”‚  â”‚                            â”‚    â”‚\nâ”‚  â”‚      [4]    [5]    [6]     â”‚    â”‚\nâ”‚  â”‚      #9     #4     #7      â”‚    â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚\nâ”‚                                     â”‚\nâ”‚  [Save Draft]  [Start Match â†’]      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Visual Rotation Grid\n- 6 positions in 2x3 grid\n- Tap position â†’ show player picker (only selected roster)\n- Empty positions show \"+\" indicator\n- Assigned positions show jersey number\n- Visual feedback on tap\n\n## Files to Create\n- `lib/features/match_setup/widgets/rotation_grid.dart` - Visual rotation picker\n- `lib/features/match_setup/widgets/unified_match_setup_screen.dart` - New single screen\n\n## Files to Modify\n- `lib/features/match_setup/match_setup_flow_screen.dart` - Replace stepper\n- Remove or deprecate stepper-related widgets\n\n## Acceptance Criteria\n- [ ] Single scrollable screen replaces stepper\n- [ ] Visual rotation grid with tap-to-assign\n- [ ] Inline validation shows errors next to fields\n- [ ] \"Save Draft\" saves incomplete work\n- [ ] Can complete setup without stepping through wizard\n- [ ] Smart suggestion: \"Auto-assign rotation\" when 6 players selected","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:47:31.847874-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:47:31.847874-05:00","dependencies":[{"issue_id":"volleyball-stats-b4v.3","depends_on_id":"volleyball-stats-b4v","type":"parent-child","created_at":"2025-12-30T22:47:31.8653859-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-b4v.4","title":"Auto-Save Draft System","description":"## Objective\nImplement auto-save functionality to prevent data loss when navigating away from match setup.\n\n## Tasks\n- [ ] Implement auto-save with debouncer (every 30 seconds after input)\n- [ ] Save on navigation away (beforeRouteLeave equivalent)\n- [ ] Save on app background/pause\n- [ ] Add subtle \"Draft saved\" indicator\n- [ ] Implement draft recovery on app restart\n- [ ] Create draft history screen\n\n## Auto-Save Behavior\n- Debounced save (30s after user input)\n- Save to local Hive immediately\n- Sync to Supabase in background if online\n- Non-intrusive indicator: \"Draft saved âœ“\"\n\n## Draft Recovery Flow\n```\nApp restarts\n    â†“\nCheck for unsaved drafts\n    â†“\nPrompt: \"Resume match setup?\"\n    â†“\nShow preview (opponent, date, player count)\n    â†“\nOptions: \"Resume\" | \"Discard\" | \"Save as Template\"\n```\n\n## Draft History Screen\n- List of all saved drafts (complete and incomplete)\n- Sort by: Most recent, By date, By opponent\n- Actions per draft:\n  - \"Continue Setup\" (incomplete)\n  - \"Clone Match\" (create new from this)\n  - \"Save as Template\"\n  - \"Delete\"\n\n## Files to Create\n- `lib/features/match_setup/widgets/draft_history_screen.dart`\n- `lib/features/match_setup/widgets/draft_recovery_dialog.dart`\n\n## Files to Modify\n- `lib/features/match_setup/providers.dart` - Add auto-save logic with Debouncer\n- `lib/main.dart` - Add lifecycle listener for app pause\n\n## Implementation\n```dart\nclass AutoSaveController {\n  final Debouncer _debouncer = Debouncer(delay: Duration(seconds: 30));\n  \n  void onFieldChanged() {\n    _debouncer.run(() =\u003e _saveDraft());\n  }\n  \n  Future\u003cvoid\u003e _saveDraft() async {\n    await hiveService.saveDraft(currentDraft);\n    _showSavedIndicator();\n  }\n}\n```\n\n## Acceptance Criteria\n- [ ] Drafts auto-save every 30 seconds after changes\n- [ ] Drafts save when leaving match setup\n- [ ] Drafts save when app goes to background\n- [ ] Draft recovery prompt on app restart\n- [ ] Draft history screen shows all drafts\n- [ ] Can resume, clone, or delete drafts","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:47:33.7003166-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:47:33.7003166-05:00","dependencies":[{"issue_id":"volleyball-stats-b4v.4","depends_on_id":"volleyball-stats-b4v","type":"parent-child","created_at":"2025-12-30T22:47:33.7083564-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-b4v.5","title":"Enhanced UX Features","description":"## Objective\nPolish the match setup experience with smart defaults, batch operations, and improved visual feedback.\n\n## Smart Defaults\n- [ ] Auto-detect current season from date\n- [ ] Pre-fill season label based on date range\n- [ ] Remember last used season label\n- [ ] Suggest players based on position (if rotation incomplete)\n- [ ] Highlight frequently used players\n- [ ] Auto-assign rotation if 6 players selected\n\n## Batch Operations\n- [ ] \"Select All\" / \"Deselect All\" for roster\n- [ ] \"Select by Position\" (e.g., all Setters)\n- [ ] \"Select Last Match Roster\" quick toggle\n- [ ] \"Clear Rotation\" (reset all positions)\n- [ ] \"Swap Positions\" (tap two positions to swap)\n- [ ] \"Rotate Left/Right\" (shift all players)\n\n## Visual Feedback\n- [ ] Progress bar showing setup completion %\n- [ ] Section badges: âœ“ Complete, âš  Incomplete, âœ— Error\n- [ ] Player count badge: \"6/12 selected\"\n- [ ] Haptic feedback on player toggle (light)\n- [ ] Haptic feedback on rotation assignment (medium)\n- [ ] Success haptic on save\n\n## Files to Modify\n- `lib/features/match_setup/widgets/roster_selection.dart` - Batch operations\n- `lib/features/match_setup/widgets/rotation_grid.dart` - Swap/rotate\n- Various match setup widgets for visual feedback\n\n## Acceptance Criteria\n- [ ] Season label auto-fills based on date\n- [ ] Batch select/deselect works\n- [ ] Visual progress indicators present\n- [ ] Haptic feedback on interactions\n- [ ] Rotation swap/rotate gestures work","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T22:47:35.415989-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:47:35.415989-05:00","dependencies":[{"issue_id":"volleyball-stats-b4v.5","depends_on_id":"volleyball-stats-b4v","type":"parent-child","created_at":"2025-12-30T22:47:35.4245546-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-b4v.5","depends_on_id":"volleyball-stats-b4v.3","type":"blocks","created_at":"2025-12-30T22:47:44.6865512-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-ba0","title":"Add Error Boundaries and Recovery","description":"## Problem\nCurrently only a single global error handler exists in main.dart. Widget errors don't recover gracefully, and users see raw error messages that expose internal details.\n\nExample of current problem:\n```dart\ncatch (error) {\n  ScaffoldMessenger.of(context).showSnackBar(\n    SnackBar(content: Text(error.toString())), // Raw error shown\n  );\n}\n// Shows: 'PostgresException: duplicate key violates unique constraint...'\n// Should show: 'Unable to save. Please try again.'\n```\n\n## Objective\nImplement feature-level error boundaries with retry mechanisms and user-friendly error messages.\n\n## Tasks\n1. Create reusable error boundary widget\n2. Add feature-level error handlers\n3. Implement retry mechanisms for failed operations\n4. Improve error messages for end users\n5. Write tests for error boundary behavior\n\n## Files to Create\n- `lib/core/errors/error_boundary.dart` - Reusable error boundary widget\n- `lib/core/errors/user_friendly_messages.dart` - Error message sanitization\n- `lib/core/errors/error_types.dart` - Custom error types\n- `lib/core/errors/retry_handler.dart` - Retry logic\n\n## Implementation\n\n### Error Boundary Widget\n```dart\nclass ErrorBoundary extends StatefulWidget {\n  final Widget child;\n  final Widget Function(Object error, VoidCallback retry)? errorBuilder;\n  final void Function(Object error, StackTrace stack)? onError;\n  \n  const ErrorBoundary({\n    required this.child,\n    this.errorBuilder,\n    this.onError,\n  });\n}\n\nclass _ErrorBoundaryState extends State\u003cErrorBoundary\u003e {\n  Object? _error;\n  \n  @override\n  Widget build(BuildContext context) {\n    if (_error != null) {\n      return widget.errorBuilder?.call(_error!, _retry) ??\n        DefaultErrorWidget(\n          error: _error!,\n          onRetry: _retry,\n        );\n    }\n    \n    return ErrorWidgetBuilder(\n      onError: (error, stack) {\n        setState(() =\u003e _error = error);\n        widget.onError?.call(error, stack);\n      },\n      child: widget.child,\n    );\n  }\n  \n  void _retry() {\n    setState(() =\u003e _error = null);\n  }\n}\n```\n\n### User-Friendly Error Messages\n```dart\nclass UserFriendlyMessages {\n  static String fromError(Object error) {\n    if (error is SocketException) {\n      return 'Unable to connect. Please check your internet connection.';\n    }\n    if (error is TimeoutException) {\n      return 'Request timed out. Please try again.';\n    }\n    if (error is AuthException) {\n      return 'Authentication failed. Please sign in again.';\n    }\n    if (error is PostgresException) {\n      if (error.message.contains('duplicate key')) {\n        return 'This item already exists.';\n      }\n      if (error.message.contains('foreign key')) {\n        return 'Unable to delete. This item is in use.';\n      }\n    }\n    // Default\n    return 'Something went wrong. Please try again.';\n  }\n}\n```\n\n### Retry Handler\n```dart\nclass RetryHandler {\n  static Future\u003cT\u003e withRetry\u003cT\u003e({\n    required Future\u003cT\u003e Function() operation,\n    int maxAttempts = 3,\n    Duration delay = const Duration(seconds: 1),\n    bool Function(Object error)? shouldRetry,\n  }) async {\n    int attempts = 0;\n    while (true) {\n      try {\n        attempts++;\n        return await operation();\n      } catch (e) {\n        if (attempts \u003e= maxAttempts) rethrow;\n        if (shouldRetry != null \u0026\u0026 !shouldRetry(e)) rethrow;\n        await Future.delayed(delay * attempts);\n      }\n    }\n  }\n}\n```\n\n## Areas to Implement Error Boundaries\n1. Rally capture - Network failures, sync errors\n2. Match setup - Repository failures, validation errors\n3. History/Dashboard - Data loading errors, calculation errors\n4. Teams/Players - CRUD operation errors\n5. Export - File generation errors\n\n## Testing Requirements\n- Error boundary catches and displays errors\n- Retry button triggers retry\n- User-friendly messages displayed (not raw errors)\n- Error logging still works for debugging\n- Recovery after error works correctly\n\n## Acceptance Criteria\n- [ ] Error boundary widget created and reusable\n- [ ] Each major feature has error boundary\n- [ ] Retry mechanisms work for transient failures\n- [ ] User sees friendly error messages\n- [ ] Technical errors logged for debugging\n- [ ] Tests cover error scenarios","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T22:41:25.3804142-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:41:25.3804142-05:00"}
{"id":"volleyball-stats-cwk","title":"Test sync issue","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T18:58:13.0020711-05:00","created_by":"Mason Beard","updated_at":"2026-01-01T18:58:49.374247-05:00","deleted_at":"2026-01-01T18:58:49.374247-05:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"volleyball-stats-d68","title":"Phase 5: Missing Features","description":"Enhancement features that improve user experience but are not critical for MVP.\n\n## Features\n- Password reset flow (users can't recover locked accounts)\n- Match-specific export (PDF/detailed export for single matches)\n- Advanced filters (season dashboard improvements)\n\n## Reference\nSee agent-docs/reports/qa-remediation-plan.md Phase 5 section for full details","status":"open","priority":3,"issue_type":"epic","created_at":"2025-12-30T22:30:48.6590401-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:30:48.6590401-05:00"}
{"id":"volleyball-stats-d68.1","title":"Password Reset Flow","description":"## Problem\nForgot Password link does nothing. Users cannot recover locked accounts.\n- `login_screen.dart:201`: `// TODO: Navigate to password reset screen`\n- No password reset screen exists\n- No Supabase password reset integration\n\n## Objective\nImplement complete password reset flow using Supabase Auth.\n\n## Tasks\n1. Create password reset request screen\n2. Implement Supabase password reset email trigger\n3. Create password reset confirmation screen\n4. Handle deep links from email\n5. Test complete recovery flow\n\n## Files to Create\n- `lib/features/auth/forgot_password_screen.dart` - Email entry form\n- `lib/features/auth/reset_password_screen.dart` - New password entry\n- Update deep link handling for reset URLs\n\n## Implementation\n\n### Forgot Password Screen\n```dart\nclass ForgotPasswordScreen extends StatefulWidget {\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(title: Text('Reset Password')),\n      body: Column(\n        children: [\n          Text('Enter your email to receive a reset link'),\n          TextField(\n            controller: _emailController,\n            decoration: InputDecoration(labelText: 'Email'),\n          ),\n          ElevatedButton(\n            onPressed: _sendResetEmail,\n            child: Text('Send Reset Link'),\n          ),\n        ],\n      ),\n    );\n  }\n  \n  Future\u003cvoid\u003e _sendResetEmail() async {\n    await Supabase.instance.client.auth.resetPasswordForEmail(\n      _emailController.text,\n      redirectTo: 'volleyballstats://reset-password',\n    );\n    // Show success message\n  }\n}\n```\n\n### Reset Password Screen\n```dart\nclass ResetPasswordScreen extends StatefulWidget {\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      appBar: AppBar(title: Text('Set New Password')),\n      body: Column(\n        children: [\n          TextField(\n            controller: _passwordController,\n            obscureText: true,\n            decoration: InputDecoration(labelText: 'New Password'),\n          ),\n          TextField(\n            controller: _confirmController,\n            obscureText: true,\n            decoration: InputDecoration(labelText: 'Confirm Password'),\n          ),\n          ElevatedButton(\n            onPressed: _updatePassword,\n            child: Text('Update Password'),\n          ),\n        ],\n      ),\n    );\n  }\n  \n  Future\u003cvoid\u003e _updatePassword() async {\n    await Supabase.instance.client.auth.updateUser(\n      UserAttributes(password: _passwordController.text),\n    );\n    // Navigate to login\n  }\n}\n```\n\n### Deep Link Handling\nConfigure URL scheme in:\n- Android: `android/app/src/main/AndroidManifest.xml`\n- iOS: `ios/Runner/Info.plist`\n\n```dart\n// Handle incoming reset links\nSupabase.instance.client.auth.onAuthStateChange.listen((event) {\n  if (event.event == AuthChangeEvent.passwordRecovery) {\n    // Navigate to reset password screen\n    context.go('/auth/reset-password');\n  }\n});\n```\n\n## Flow\n1. User taps \"Forgot Password\" on login screen\n2. User enters email on forgot password screen\n3. User receives email with reset link\n4. User taps link â†’ app opens reset password screen\n5. User enters new password\n6. User redirected to login with success message\n\n## Testing Requirements\n- Email validation on forgot password screen\n- Password strength validation\n- Password confirmation match\n- Deep link handling\n- Error handling (invalid email, expired link)\n\n## Acceptance Criteria\n- [ ] Forgot Password link navigates to reset screen\n- [ ] Email triggers Supabase reset email\n- [ ] Deep link opens reset password screen\n- [ ] New password updates successfully\n- [ ] User redirected to login on success\n- [ ] Error cases handled gracefully","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T22:42:35.5197599-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:42:35.5197599-05:00","dependencies":[{"issue_id":"volleyball-stats-d68.1","depends_on_id":"volleyball-stats-d68","type":"parent-child","created_at":"2025-12-30T22:42:35.5345547-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-d68.1","depends_on_id":"volleyball-stats-wts.4","type":"blocks","created_at":"2025-12-30T22:42:55.6281905-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-d68.2","title":"Match-Specific Export (PDF)","description":"## Problem\nExport functionality exists for CSV but match-specific PDF export is incomplete.\n- `match_recap_screen.dart:192`: `// TODO: Implement match-specific export`\n- `export_screen.dart:81`: `// TODO: Add match summary option`\n\n## Objective\nImplement detailed PDF export for single matches with comprehensive statistics.\n\n## Tasks\n1. Create match-specific export option\n2. Implement PDF generation using Flutter PDF package\n3. Design PDF layout with all match statistics\n4. Add export button to match recap screen\n5. Test PDF generation and file saving\n\n## Files to Create\n- `lib/features/export/pdf_export_service.dart` - PDF generation logic\n- `lib/features/export/templates/match_pdf_template.dart` - PDF layout\n\n## Files to Modify\n- `lib/features/export/export_service.dart` - Add PDF export method\n- `lib/features/history/match_recap_screen.dart` - Add export button\n- `lib/features/export/export_screen.dart` - Add match option\n\n## PDF Content\n\n### Page 1: Match Overview\n- Team name vs Opponent\n- Date, location\n- Final score (sets)\n- Match duration (if tracked)\n- Overall statistics summary\n\n### Page 2: Set-by-Set Breakdown\nFor each set:\n- Score\n- Rally count\n- FBK count\n- Transition points\n- Key moments (timeouts, subs)\n\n### Page 3: Player Performance\nTable with columns:\n- Player name, jersey\n- Kills, Errors, Attempts\n- Attack Efficiency\n- Blocks\n- Aces, Serve Errors\n- Total Points\n\n### Page 4: Charts (Optional)\n- Point progression chart\n- Player contribution pie chart\n\n## Implementation\n\n### PDF Export Service\n```dart\nclass PdfExportService {\n  Future\u003cUint8List\u003e generateMatchPdf(Match match, List\u003cSetSummary\u003e sets, List\u003cPlayerPerformance\u003e players) async {\n    final pdf = pw.Document();\n    \n    // Page 1: Overview\n    pdf.addPage(\n      pw.Page(\n        build: (context) =\u003e pw.Column(\n          children: [\n            _buildHeader(match),\n            _buildScoreCard(match),\n            _buildOverviewStats(match),\n          ],\n        ),\n      ),\n    );\n    \n    // Page 2: Sets\n    pdf.addPage(\n      pw.Page(\n        build: (context) =\u003e pw.Column(\n          children: sets.map(_buildSetRow).toList(),\n        ),\n      ),\n    );\n    \n    // Page 3: Players\n    pdf.addPage(\n      pw.Page(\n        build: (context) =\u003e _buildPlayerTable(players),\n      ),\n    );\n    \n    return pdf.save();\n  }\n  \n  pw.Widget _buildPlayerTable(List\u003cPlayerPerformance\u003e players) {\n    return pw.Table(\n      children: [\n        pw.TableRow(children: [\n          pw.Text('Player'),\n          pw.Text('K'),\n          pw.Text('E'),\n          pw.Text('Att'),\n          pw.Text('Eff'),\n          pw.Text('B'),\n          pw.Text('A'),\n          pw.Text('Pts'),\n        ]),\n        ...players.map((p) =\u003e pw.TableRow(children: [\n          pw.Text('${p.jerseyNumber} ${p.name}'),\n          pw.Text('${p.kills}'),\n          pw.Text('${p.errors}'),\n          pw.Text('${p.attempts}'),\n          pw.Text('${p.efficiency.toStringAsFixed(3)}'),\n          pw.Text('${p.blocks}'),\n          pw.Text('${p.aces}'),\n          pw.Text('${p.totalPoints}'),\n        ])),\n      ],\n    );\n  }\n}\n```\n\n### Export Button on Match Recap\n```dart\nIconButton(\n  icon: Icon(Icons.picture_as_pdf),\n  tooltip: 'Export to PDF',\n  onPressed: () async {\n    final pdf = await pdfExportService.generateMatchPdf(match, sets, players);\n    await Share.shareXFiles([XFile.fromData(pdf, mimeType: 'application/pdf')]);\n  },\n)\n```\n\n## Dependencies\nAdd to pubspec.yaml:\n```yaml\ndependencies:\n  pdf: ^3.10.0\n  share_plus: ^7.0.0\n  path_provider: ^2.1.0\n```\n\n## Testing Requirements\n- PDF generates without errors\n- All data appears correctly\n- PDF opens in viewer apps\n- Share functionality works\n- File saves to device\n\n## Acceptance Criteria\n- [ ] Export button on match recap screen\n- [ ] PDF contains match overview\n- [ ] PDF contains set-by-set breakdown\n- [ ] PDF contains player statistics table\n- [ ] PDF can be shared/saved\n- [ ] Works on iOS and Android","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T22:42:38.248941-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:42:38.248941-05:00","dependencies":[{"issue_id":"volleyball-stats-d68.2","depends_on_id":"volleyball-stats-d68","type":"parent-child","created_at":"2025-12-30T22:42:38.2691504-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-d68.3","title":"Advanced Dashboard Filters","description":"## Problem\nSeason dashboard has basic filtering but needs improvements for better data analysis.\n\n## Objective\nEnhance filtering capabilities on season dashboard with more filter options and ability to save presets.\n\n## Tasks\n1. Improve date range picker\n2. Add player filter\n3. Add opponent filter (multi-select)\n4. Implement filter presets (save/load)\n5. Add filter chips showing active filters\n\n## Current State\nSeason dashboard has:\n- Basic date range (start/end)\n- Single opponent filter\n\n## Enhanced Filters Needed\n\n### 1. Date Range Improvements\n- Quick presets: \"Last 7 days\", \"Last 30 days\", \"This season\", \"All time\"\n- Custom date range picker\n- Compare periods (this month vs last month)\n\n### 2. Player Filter\n- Multi-select players\n- Filter stats to show only selected players\n- \"All players\" default\n\n### 3. Opponent Filter Improvements\n- Multi-select opponents\n- Search/filter opponent list\n- \"All opponents\" default\n\n### 4. Match Type Filter (Future)\n- League games\n- Tournament games\n- Scrimmages\n- (Requires match type field in database)\n\n### 5. Filter Presets\n- Save current filters as preset\n- Name preset (e.g., \"Conference games 2024\")\n- Load saved presets\n- Delete presets\n\n## Implementation\n\n### Filter State\n```dart\nclass SeasonDashboardFilters {\n  final DateRange? dateRange;\n  final List\u003cString\u003e selectedPlayerIds;\n  final List\u003cString\u003e selectedOpponents;\n  final String? matchType;\n  final String? presetName;\n  \n  bool get hasActiveFilters =\u003e \n    dateRange != null || \n    selectedPlayerIds.isNotEmpty || \n    selectedOpponents.isNotEmpty;\n}\n```\n\n### Filter Chips Display\n```dart\nWidget _buildActiveFilters(SeasonDashboardFilters filters) {\n  return Wrap(\n    children: [\n      if (filters.dateRange != null)\n        FilterChip(\n          label: Text('${filters.dateRange!.start} - ${filters.dateRange!.end}'),\n          onDeleted: () =\u003e ref.read(filtersProvider.notifier).clearDateRange(),\n        ),\n      for (final player in filters.selectedPlayerIds)\n        FilterChip(\n          label: Text(playerName(player)),\n          onDeleted: () =\u003e ref.read(filtersProvider.notifier).removePlayer(player),\n        ),\n      // ... more chips\n      if (filters.hasActiveFilters)\n        ActionChip(\n          label: Text('Clear All'),\n          onPressed: () =\u003e ref.read(filtersProvider.notifier).clearAll(),\n        ),\n    ],\n  );\n}\n```\n\n### Filter Presets\n```dart\nclass FilterPreset {\n  final String id;\n  final String name;\n  final SeasonDashboardFilters filters;\n  final DateTime createdAt;\n}\n\n// Store in Hive\nfinal presetBox = Hive.box\u003cFilterPreset\u003e('filter_presets');\n```\n\n### Date Range Presets\n```dart\nenum DateRangePreset {\n  last7Days,\n  last30Days,\n  thisMonth,\n  lastMonth,\n  thisSeason,\n  allTime,\n  custom,\n}\n\nDateRange getPresetRange(DateRangePreset preset) {\n  final now = DateTime.now();\n  switch (preset) {\n    case DateRangePreset.last7Days:\n      return DateRange(now.subtract(Duration(days: 7)), now);\n    case DateRangePreset.last30Days:\n      return DateRange(now.subtract(Duration(days: 30)), now);\n    // ... etc\n  }\n}\n```\n\n## UI Design\n- Filter button in app bar opens filter sheet\n- Bottom sheet with all filter options\n- Date range section with presets and custom picker\n- Player selection with checkboxes\n- Opponent selection with checkboxes\n- Save as Preset button at bottom\n- Apply and Clear buttons\n\n## Testing Requirements\n- Date range filtering works correctly\n- Player filter shows correct stats\n- Opponent filter works with multi-select\n- Presets save and load correctly\n- Filter chips display and dismiss\n\n## Acceptance Criteria\n- [ ] Date range presets work\n- [ ] Custom date range picker works\n- [ ] Player filter with multi-select\n- [ ] Opponent filter with multi-select\n- [ ] Can save filter presets\n- [ ] Can load saved presets\n- [ ] Filter chips show active filters\n- [ ] Clear all removes all filters","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-30T22:42:41.1139703-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:42:41.1139703-05:00","dependencies":[{"issue_id":"volleyball-stats-d68.3","depends_on_id":"volleyball-stats-d68","type":"parent-child","created_at":"2025-12-30T22:42:41.130067-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql","title":"Phase 11: History Dashboards \u0026 Match Analytics","description":"Build history dashboards and match analytics to help coaches review past matches, analyze performance trends, and make data-driven decisions.\n\n## Goals\n1. Match History View - Display list of completed matches with key stats\n2. Match Recap Screen - Detailed breakdown of single match with set-by-set analysis\n3. Set Dashboard - Live and historical set statistics with visual summaries\n4. Season Dashboard - Aggregate statistics across multiple matches with filters\n5. Basic Analytics - Key performance indicators (KPIs) and trends\n\n## Success Criteria\n- Coaches can view all completed matches\n- Match recap shows comprehensive statistics\n- Season dashboard displays aggregate statistics\n- Filters work correctly (date range, opponent)\n- Analytics calculations are accurate\n- Performance \u003c2s load time for match list\n- Works offline (cached match summaries)\n\n## Dependencies\n- Assumes matches are being saved to Supabase after completion\n- May need to enhance rally capture for proper match completion\n- RLS policies must allow coaches to view their own match data\n\n## Reference\nSee agent-docs/active/todos/phase-11-plan.md for full specification","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-30T22:22:27.6358226-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:22:27.6358226-05:00"}
{"id":"volleyball-stats-dql.1","title":"Match History List Screen","description":"## Objective\nCreate a screen showing all completed matches for the selected team with quick stats and filtering capabilities.\n\n## Features Required\n- List of matches sorted by date (newest first)\n- Display for each match: opponent, date, score (sets won/lost), match result\n- Quick stats per match: total rallies, FBK count, transition points\n- Filter by: date range, opponent, season\n- Search by opponent name\n- Tap to navigate to match recap screen\n\n## Files to Create\n1. `app/lib/features/history/match_history_screen.dart` - Main screen widget with list view\n2. `app/lib/features/history/models/match_summary.dart` - MatchSummary model class:\n   ```dart\n   class MatchSummary {\n     final String matchId;\n     final String opponent;\n     final DateTime matchDate;\n     final String location;\n     final int setsWon;\n     final int setsLost;\n     final int totalRallies;\n     final int totalFBK;\n     final int totalTransitionPoints;\n     final bool isWin; // true if setsWon \u003e setsLost\n   }\n   ```\n3. `app/lib/features/history/providers.dart` - Riverpod providers for history feature\n\n## Files to Modify\n1. `app/lib/features/match_setup/match_setup_landing_screen.dart` - Add \"Match History\" navigation card\n2. `app/lib/features/match_setup/data/match_setup_repository.dart` - Add `fetchMatchSummaries()` method\n3. `app/lib/core/router/app_router.dart` - Add route for match history screen\n\n## Database Queries Needed\n- Query `matches` table filtered by `team_id`\n- Join with `sets` to get set scores\n- Aggregate rally counts and action types\n- Order by `match_date` DESC\n- Support pagination for large match lists\n\n## UI/UX Requirements\n- Show skeleton loaders while fetching\n- Empty state with friendly message when no matches exist\n- Pull-to-refresh functionality\n- Clear error messages if fetch fails\n- Cache match summaries locally for offline viewing\n\n## Testing Requirements\n- Widget test for list rendering with mock data\n- Unit test for MatchSummary model serialization\n- Test filter functionality (date range, opponent)\n- Test empty state display\n- Test error state handling\n\n## Acceptance Criteria\n- [ ] Match list loads and displays correctly\n- [ ] Filters work as expected\n- [ ] Search filters matches by opponent name\n- [ ] Tapping a match navigates to recap screen\n- [ ] Works offline with cached data\n- [ ] Performance: list loads in \u003c2 seconds","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:03.2871473-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:03.2871473-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.1","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:03.3004255-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.2","title":"Match Recap Screen","description":"## Objective\nCreate a detailed view of a single match showing comprehensive statistics with set-by-set breakdown and per-player performance.\n\n## Features Required\n\n### Match Header\n- Opponent name, date, location\n- Final score (sets won/lost)\n- Match duration (if tracked)\n- Match result indicator (W/L)\n\n### Set Summary Cards\nFor each set display:\n- Score (our score - opponent score)\n- Rally count\n- FBK count\n- Transition points\n- Win/Loss indicator\n- Expandable for more details\n\n### Overall Match Stats\n- Total rallies played\n- Total First Ball Kills (FBK)\n- Total transition points\n- Substitutions used\n- Timeouts called (ours and opponent)\n\n### Per-Player Performance Table\n- Attack stats: kills, errors, attempts, efficiency\n- Block stats: blocks, block errors\n- Serve stats: aces, errors\n- Total points contributed (kills + blocks + aces)\n\n### Additional Features\n- Timeline view: rally-by-rally breakdown (collapsible/expandable)\n- Export button: generate CSV/PDF for this match\n- Share button (future enhancement)\n\n## Files to Create\n1. `app/lib/features/history/match_recap_screen.dart` - Main recap screen\n2. `app/lib/features/history/widgets/set_summary_card.dart` - Card widget for each set\n3. `app/lib/features/history/widgets/player_performance_card.dart` - Player stats table\n4. `app/lib/features/history/widgets/match_stats_summary.dart` - Overall match statistics\n5. `app/lib/features/history/widgets/rally_timeline.dart` - Optional timeline view\n\n## Files to Modify\n1. `app/lib/features/match_setup/data/match_setup_repository.dart` - Add `fetchFullMatchDetails(matchId)` method\n2. `app/lib/features/export/export_service.dart` - Add match-specific export methods\n3. `app/lib/core/router/app_router.dart` - Add route with matchId parameter\n\n## Data Models\n```dart\nclass SetSummary {\n  final int setNumber;\n  final int ourScore;\n  final int opponentScore;\n  final int rallyCount;\n  final int fbkCount;\n  final int transitionPoints;\n  final bool isWin;\n  final Duration? duration;\n}\n\nclass PlayerPerformance {\n  final String playerId;\n  final String playerName;\n  final int jerseyNumber;\n  final int kills;\n  final int errors;\n  final int attempts;\n  final double attackEfficiency; // (kills - errors) / attempts\n  final double killPercentage;   // kills / attempts\n  final int blocks;\n  final int aces;\n  final int totalPoints;         // kills + blocks + aces\n}\n```\n\n## Data Aggregation Logic\n1. Load match with all sets from repository\n2. For each set, aggregate rallies and actions\n3. Calculate per-player statistics from actions table\n4. Compute efficiency ratios:\n   - Attack efficiency = (kills - errors) / total attempts\n   - Kill percentage = kills / total attempts\n\n## UI/UX Requirements\n- Scrollable content with sticky header\n- Expandable/collapsible sections\n- Loading skeleton while data fetches\n- Clear visual hierarchy\n- Responsive layout for different screen sizes\n- Support landscape mode for detailed tables\n\n## Testing Requirements\n- Widget test for screen layout\n- Unit tests for PlayerPerformance calculations\n- Unit tests for SetSummary aggregation\n- Test export functionality\n- Test navigation from match history\n\n## Acceptance Criteria\n- [ ] Match header displays correctly\n- [ ] Set cards show accurate scores and stats\n- [ ] Player performance table shows all players\n- [ ] Efficiency calculations are accurate\n- [ ] Export generates valid CSV/PDF\n- [ ] Screen handles loading and error states\n- [ ] Works offline with cached match data","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:04.8395609-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:04.8395609-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.2","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:04.8575716-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-dql.2","depends_on_id":"volleyball-stats-dql.1","type":"blocks","created_at":"2025-12-30T22:25:20.5541958-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-dql.2","depends_on_id":"volleyball-stats-dql.5","type":"blocks","created_at":"2025-12-30T22:25:22.2338376-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.3","title":"Set Dashboard Screen","description":"## Objective\nCreate a visual dashboard showing live and historical set statistics with serve rotation summaries and point flow visualization.\n\n## Features Required\n\n### Set Overview Section\n- Current set score (our score vs opponent)\n- Rally count for current set\n- Time elapsed in set (if tracking)\n- Set number indicator (Set 1, Set 2, etc.)\n\n### Running Totals Bar\nReuse existing component from rally capture:\n- FBK count\n- Wins count\n- Losses count\n- Transition points\n\n### Serve Rotation Summary\n- Display each rotation (1-6) with serve efficiency\n- Show rotation order and player assignments\n- Visual indicator for current rotation\n- Stats per rotation: points scored, errors\n\n### Point Flow Chart\n- Visual representation of point scoring over time\n- X-axis: rally number\n- Y-axis: score differential (us - them)\n- Color coding for momentum shifts\n- Consider using `fl_chart` package\n\n### Key Moments Highlights\n- Substitutions made (who in, who out, when)\n- Timeouts called (ours and opponent)\n- Significant rallies (e.g., long rallies, big runs)\n\n### Set Comparison Panel\n- Compare current set to previous sets in match\n- Side-by-side stats comparison\n- Trend indicators (improving/declining)\n\n## Files to Create\n1. `app/lib/features/history/set_dashboard_screen.dart` - Main dashboard screen\n2. `app/lib/features/history/widgets/rotation_summary_widget.dart` - Serve rotation display\n3. `app/lib/features/history/widgets/point_flow_chart.dart` - Score progression chart\n4. `app/lib/features/history/widgets/set_comparison_widget.dart` - Set vs set comparison\n5. `app/lib/features/history/widgets/key_moments_list.dart` - Substitutions/timeouts timeline\n\n## Files to Modify\n1. `app/lib/features/rally_capture/rally_capture_screen.dart` - Add navigation button to set dashboard\n2. `app/lib/features/rally_capture/providers.dart` - Expose set-level statistics for dashboard\n3. `app/lib/core/router/app_router.dart` - Add route for set dashboard\n\n## Dependencies\n- Consider adding `fl_chart: ^0.68.0` for charts (or use simpler custom widgets)\n- Reuse running totals component from rally_capture feature\n\n## Data Requirements\n- Real-time access to current set data during live match\n- Historical set data for completed sets\n- Rally-by-rally point data for flow chart\n- Rotation data linked to rallies\n\n## UI/UX Requirements\n- Dashboard layout with cards/tiles\n- Responsive to different screen sizes\n- Real-time updates during live match (use Riverpod watch)\n- Smooth animations for score changes\n- Clear visual hierarchy\n\n## Testing Requirements\n- Widget test for dashboard layout\n- Test rotation summary display\n- Test point flow chart rendering with various data\n- Test set comparison calculations\n- Test live update functionality\n\n## Acceptance Criteria\n- [ ] Set overview shows accurate current stats\n- [ ] Rotation summary displays all 6 rotations\n- [ ] Point flow chart renders correctly\n- [ ] Key moments list shows subs and timeouts\n- [ ] Set comparison works for multiple sets\n- [ ] Dashboard updates in real-time during match\n- [ ] Accessible from rally capture screen","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:06.3584904-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:06.3584904-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.3","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:06.3660985-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.4","title":"Season Dashboard Screen","description":"## Objective\nCreate a comprehensive season dashboard showing aggregate statistics across multiple matches with filtering and trend analysis.\n\n## Features Required\n\n### Season Overview Card\n- Total matches played\n- Overall win/loss record\n- Total sets won/lost\n- Win percentage\n- Current streak (wins/losses)\n\n### Team Statistics Section\n- Total FBK across all matches\n- Average FBK per match\n- Total transition points\n- Average transition points per match\n- Total rallies played\n- Average rallies per match\n\n### Top Performers Leaderboard\nDisplay top 3-5 players in each category:\n- Most kills (total and per match average)\n- Highest attack efficiency\n- Most blocks\n- Most aces\n- Most total points contributed\n\n### Match Trends Section\nCharts showing trends over time:\n- Win/loss trend (line chart or bar chart)\n- FBK trend over matches\n- Average score differential over time\n- Performance by opponent (grouped bar chart)\n\n### Filters Panel\n- Date range picker (start date, end date)\n- Opponent filter (multi-select dropdown)\n- Season selector (if multiple seasons)\n- Match type filter (league, tournament, scrimmage - future)\n- Apply/Clear filters buttons\n\n## Files to Create\n1. `app/lib/features/history/season_dashboard_screen.dart` - Main dashboard screen\n2. `app/lib/features/history/widgets/season_overview_card.dart` - Win/loss summary\n3. `app/lib/features/history/widgets/top_performers_widget.dart` - Leaderboard display\n4. `app/lib/features/history/widgets/match_trends_chart.dart` - Trend visualizations\n5. `app/lib/features/history/widgets/season_filters.dart` - Filter controls\n6. `app/lib/features/history/models/season_stats.dart` - Season aggregate model\n7. `app/lib/features/history/providers/season_dashboard_providers.dart` - State management\n\n## Files to Modify\n1. `app/lib/features/match_setup/match_setup_landing_screen.dart` - Add \"Season Dashboard\" navigation\n2. `app/lib/features/match_setup/data/match_setup_repository.dart` - Add season aggregation methods:\n   - `fetchSeasonStats(teamId, startDate, endDate)`\n   - `fetchTopPerformers(teamId, startDate, endDate)`\n   - `fetchMatchTrends(teamId, startDate, endDate)`\n3. `app/lib/core/router/app_router.dart` - Add route for season dashboard\n\n## Data Models\n```dart\nclass SeasonStats {\n  final int matchesPlayed;\n  final int matchesWon;\n  final int matchesLost;\n  final int setsWon;\n  final int setsLost;\n  final double winPercentage;\n  final int totalFBK;\n  final double avgFBKPerMatch;\n  final int totalTransitionPoints;\n  final int totalRallies;\n  final int currentStreak; // positive = wins, negative = losses\n}\n\nclass TopPerformer {\n  final String playerId;\n  final String playerName;\n  final int jerseyNumber;\n  final int totalValue;      // total kills, blocks, etc.\n  final double avgValue;     // per-match average\n  final String category;     // 'kills', 'blocks', 'aces', 'efficiency'\n}\n\nclass MatchTrend {\n  final DateTime matchDate;\n  final String opponent;\n  final bool isWin;\n  final int fbkCount;\n  final int scoreDifferential;\n}\n```\n\n## Database Aggregation\n- Query all matches for team within date range\n- Aggregate statistics across matches (SUM, AVG)\n- Calculate per-player totals and averages\n- Group by opponent for comparison view\n- Support efficient pagination for large datasets\n\n## UI/UX Requirements\n- Dashboard layout with scrollable sections\n- Charts should be interactive (tap for details)\n- Filters should update dashboard in real-time\n- Loading states for each section independently\n- Empty states when no data matches filters\n- Responsive layout for tablet/desktop\n\n## Testing Requirements\n- Widget tests for each dashboard section\n- Unit tests for season stats calculations\n- Test filter apply/clear functionality\n- Test chart rendering with various data\n- Test empty state when no matches\n- Test performance with large dataset\n\n## Acceptance Criteria\n- [ ] Season overview shows accurate win/loss record\n- [ ] Top performers display correct rankings\n- [ ] Trend charts render correctly\n- [ ] All filters work individually and combined\n- [ ] Dashboard updates when filters change\n- [ ] Works offline with cached data\n- [ ] Performance acceptable with 50+ matches","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:07.8837426-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:07.8837426-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.4","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:07.8969774-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-dql.4","depends_on_id":"volleyball-stats-dql.5","type":"blocks","created_at":"2025-12-30T22:25:23.8408422-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.5","title":"Analytics Calculator \u0026 KPIs","description":"## Objective\nImplement core analytics calculation utilities and key performance indicators (KPIs) that will be used across all dashboard screens.\n\n## KPIs to Implement\n\n### Team-Level KPIs\n1. **FBK Percentage**: (First Ball Kills / Total Rallies) Ã— 100\n   - Measures sideout efficiency on first attack\n2. **Transition Point Percentage**: (Transition Points / Total Rallies) Ã— 100\n   - Measures efficiency in extended rallies\n3. **Win Rate**: (Matches Won / Total Matches) Ã— 100\n4. **Set Win Rate**: (Sets Won / Total Sets) Ã— 100\n5. **Average Rally Length**: Total Rallies / Total Points (if tracking)\n\n### Player-Level KPIs\n1. **Attack Efficiency**: (Kills - Errors) / Total Attempts\n   - Range: -1.0 to 1.0, higher is better\n   - Elite level: \u003e 0.300\n2. **Kill Percentage**: Kills / Total Attempts Ã— 100\n   - Measures pure kill rate without penalizing errors\n3. **Block Efficiency**: Blocks / Block Attempts (if tracking attempts)\n4. **Serve Efficiency**: (Aces - Serve Errors) / Total Serves\n5. **Points Per Set**: Total Points / Sets Played\n   - Quick measure of offensive contribution\n\n### Derived Metrics\n1. **Scoring Run Detection**: Identify runs of 3+ consecutive points\n2. **Momentum Shifts**: Score differential changes \u003e 3 points\n3. **Clutch Performance**: Stats in close sets (within 2 points at 20+)\n\n## Files to Create\n1. `app/lib/features/history/utils/analytics_calculator.dart` - Core calculation functions\n2. `app/lib/features/history/models/kpi_summary.dart` - KPI result models\n3. `app/lib/features/history/utils/trend_analyzer.dart` - Trend detection utilities\n4. `app/lib/features/history/widgets/kpi_display_card.dart` - Reusable KPI display widget\n\n## Implementation Details\n\n### analytics_calculator.dart\n```dart\nclass AnalyticsCalculator {\n  // Team KPIs\n  static double calculateFBKPercentage(int fbkCount, int totalRallies);\n  static double calculateTransitionPercentage(int transitionPoints, int totalRallies);\n  static double calculateWinRate(int matchesWon, int totalMatches);\n  \n  // Player KPIs\n  static double calculateAttackEfficiency(int kills, int errors, int attempts);\n  static double calculateKillPercentage(int kills, int attempts);\n  static double calculateServeEfficiency(int aces, int errors, int totalServes);\n  \n  // Aggregate calculations\n  static PlayerPerformance aggregatePlayerStats(List\u003cRally\u003e rallies, String playerId);\n  static SeasonStats aggregateSeasonStats(List\u003cMatch\u003e matches);\n  \n  // Helpers\n  static String formatEfficiency(double efficiency); // e.g., \".285\" or \"-.050\"\n  static String formatPercentage(double value); // e.g., \"45.2%\"\n  static Color getEfficiencyColor(double efficiency); // green/yellow/red\n}\n```\n\n### kpi_summary.dart\n```dart\nclass KPISummary {\n  final double fbkPercentage;\n  final double transitionPercentage;\n  final double winRate;\n  final double attackEfficiency;\n  final double killPercentage;\n  // ... other KPIs\n  \n  // Comparison helpers\n  bool isBetterThan(KPISummary other);\n  Map\u003cString, double\u003e getDifferences(KPISummary other);\n}\n\nclass KPIThresholds {\n  // Define what's considered good/average/poor for each KPI\n  static const double excellentAttackEfficiency = 0.300;\n  static const double goodAttackEfficiency = 0.200;\n  static const double averageAttackEfficiency = 0.100;\n  // ... etc\n}\n```\n\n### kpi_display_card.dart\nReusable widget for displaying a single KPI:\n- KPI name/label\n- Current value (formatted)\n- Trend indicator (up/down/stable arrow)\n- Color coding based on thresholds\n- Optional: comparison to previous period\n\n## Files to Modify\n1. `app/lib/features/history/match_recap_screen.dart` - Display KPIs in recap\n2. `app/lib/features/history/season_dashboard_screen.dart` - Display season KPIs\n3. `app/lib/features/rally_capture/providers.dart` - Real-time KPI calculation during match\n\n## Edge Cases to Handle\n- Division by zero (0 attempts, 0 rallies)\n- Null/missing data for optional stats\n- Partial match data (incomplete sets)\n- Very small sample sizes (flag as \"insufficient data\")\n\n## Testing Requirements\n1. **Unit Tests for All Calculations**\n   - Test with known input/output pairs\n   - Test edge cases (0 values, negative scenarios)\n   - Test boundary conditions\n   \n2. **Test Cases**\n   ```dart\n   // Attack efficiency tests\n   expect(calculateAttackEfficiency(10, 3, 25), equals(0.28));\n   expect(calculateAttackEfficiency(0, 0, 0), equals(0.0)); // no division by zero\n   expect(calculateAttackEfficiency(5, 10, 20), equals(-0.25)); // negative efficiency\n   \n   // FBK percentage tests\n   expect(calculateFBKPercentage(15, 50), equals(30.0));\n   expect(calculateFBKPercentage(0, 100), equals(0.0));\n   ```\n\n3. **Widget Tests**\n   - KPI display card renders correctly\n   - Color coding matches thresholds\n   - Trend arrows display correctly\n\n## Acceptance Criteria\n- [ ] All KPI calculations are accurate\n- [ ] Edge cases handled gracefully (no crashes)\n- [ ] KPI display widget is reusable\n- [ ] Color coding helps users quickly assess performance\n- [ ] Calculations are efficient (no performance issues)\n- [ ] 100% unit test coverage on calculator functions\n- [ ] KPIs display correctly in match recap and season dashboard","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:09.518097-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:09.518097-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.5","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:09.5268505-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-e2t","title":"Phase 3: Test Coverage","description":"Comprehensive test coverage to ensure quality and prevent regressions. Current coverage is ~15% with 53 tests - target is 80%+ coverage with 200+ tests.\n\n## Coverage Goals\n- Screen widget tests for all 10 main screens\n- Business logic unit tests (80%+ coverage)\n- Repository integration tests\n- Error scenario tests\n- E2E integration tests\n\n## Test Pyramid Target\n- Unit/Widget: 70% of tests\n- Integration: 25% of tests\n- E2E: 5% of tests\n\n## Reference\nSee agent-docs/reports/qa-remediation-plan.md Phase 3 section for full details","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-30T22:30:46.9849968-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:30:46.9849968-05:00"}
{"id":"volleyball-stats-e2t.1","title":"Screen Widget Tests (10 Screens)","description":"## Objective\nCreate widget tests for all 10 main screens to verify rendering, states, and interactions.\n\n## Screens to Test (0/10 currently tested)\n1. HomeScreen\n2. MatchSetupLandingScreen\n3. TeamListScreen, TeamCreateScreen, TeamEditScreen\n4. PlayerListScreen, PlayerCreateScreen, PlayerEditScreen\n5. SetDashboardScreen âš ï¸ CRITICAL - Has complex sorting/filtering logic\n6. MatchRecapScreen âš ï¸ CRITICAL - Aggregates match stats\n7. SeasonDashboardScreen\n8. MatchHistoryScreen\n9. ExportScreen\n10. LoginScreen, SignupScreen\n\n## Files to Create\n- `test/features/match_setup/home_screen_test.dart`\n- `test/features/match_setup/match_setup_landing_screen_test.dart`\n- `test/features/history/set_dashboard_screen_test.dart` âš ï¸ HIGH PRIORITY\n- `test/features/history/match_recap_screen_test.dart` âš ï¸ HIGH PRIORITY\n- `test/features/history/season_dashboard_screen_test.dart`\n- `test/features/history/match_history_screen_test.dart`\n- `test/features/teams/team_list_screen_test.dart`\n- `test/features/players/player_list_screen_test.dart`\n- `test/features/export/export_screen_test.dart`\n- `test/features/auth/login_screen_test.dart`\n\n## Test Cases Per Screen\n\n### Standard Test Cases (each screen)\n```dart\ntestWidgets('Screen displays correctly with data', (tester) async {\n  await tester.pumpWidget(createTestApp(child: Screen()));\n  await tester.pumpAndSettle();\n  \n  expect(find.text('Expected Title'), findsOneWidget);\n  expect(find.byType(LoadingIndicator), findsNothing);\n});\n\ntestWidgets('Screen shows loading state', (tester) async {\n  // Mock loading state\n  await tester.pumpWidget(createTestApp(child: Screen()));\n  \n  expect(find.byType(CircularProgressIndicator), findsOneWidget);\n});\n\ntestWidgets('Screen shows error state', (tester) async {\n  // Mock error\n  await tester.pumpWidget(createTestApp(\n    overrides: [provider.overrideWith((ref) =\u003e throw 'Error')],\n    child: Screen(),\n  ));\n  await tester.pumpAndSettle();\n  \n  expect(find.text('Error message'), findsOneWidget);\n  expect(find.byType(RetryButton), findsOneWidget);\n});\n\ntestWidgets('Screen shows empty state', (tester) async {\n  // Mock empty data\n  await tester.pumpWidget(createTestApp(\n    overrides: [provider.overrideWith((ref) =\u003e [])],\n    child: Screen(),\n  ));\n  await tester.pumpAndSettle();\n  \n  expect(find.text('No items found'), findsOneWidget);\n});\n```\n\n### Priority Test Cases\n1. **SetDashboardScreen**: Test sorting (by kills, efficiency, jersey), filtering, player cards\n2. **MatchRecapScreen**: Test stat aggregation display, set summary cards, player performance\n3. **MatchHistoryScreen**: Test date filters, opponent search, match list rendering\n\n## Test Utilities to Create\n```dart\n// test/helpers/test_app.dart\nWidget createTestApp({\n  required Widget child,\n  List\u003cOverride\u003e? overrides,\n}) {\n  return ProviderScope(\n    overrides: overrides ?? [],\n    child: MaterialApp(home: child),\n  );\n}\n\n// Mock providers\nfinal mockTeamProvider = Provider\u003cTeam\u003e((ref) =\u003e testTeam);\nfinal mockMatchProvider = Provider\u003cList\u003cMatch\u003e\u003e((ref) =\u003e testMatches);\n```\n\n## Acceptance Criteria\n- [ ] All 10 screens have widget tests\n- [ ] Each screen tests: happy path, loading, error, empty states\n- [ ] Interactive elements tested (buttons, forms, navigation)\n- [ ] Tests run in \u003c 30 seconds total\n- [ ] No flaky tests","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T22:40:08.5814827-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:40:08.5814827-05:00","dependencies":[{"issue_id":"volleyball-stats-e2t.1","depends_on_id":"volleyball-stats-e2t","type":"parent-child","created_at":"2025-12-30T22:40:08.5893721-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-e2t.2","title":"Business Logic Unit Tests","description":"## Objective\nCreate comprehensive unit tests for all business logic with target 80%+ coverage on calculation modules.\n\n## Areas to Test\n\n### 1. Analytics Calculator (NOT TESTED)\n- FBK percentage calculation\n- Transition point percentage\n- Attack efficiency: (kills - errors) / total attempts\n- Kill percentage: kills / total attempts\n- Block efficiency\n- Serve efficiency\n- Win rate calculations\n\n### 2. Running Totals Provider (NOT TESTED)\n- FBK counting\n- Win/Loss tracking\n- Transition point tracking\n- Substitution limit tracking (15 per set)\n- Timeout tracking\n\n### 3. Player Stats Provider (NOT TESTED)\n- Per-player stat aggregation\n- Attack efficiency calculation\n- Service pressure metrics\n- Total points calculation\n\n### 4. Export CSV Service (NOT TESTED)\n- CSV data formatting\n- Column generation\n- Data type handling\n- Edge cases (empty data, special characters)\n\n### 5. Rally Sync Logic (NOT TESTED)\n- Offline queue management\n- Retry logic\n- Error handling\n\n### 6. Substitution Logic (NOT TESTED)\n- 15 per set limit validation\n- Substitution tracking\n- Re-entry rules (if applicable)\n\n### 7. Rotation Logic (NOT TESTED - not implemented yet)\n- Rotation advancement (1-6)\n- Side-out detection\n- Per-rotation stats\n\n## Files to Create\n- `test/features/history/utils/analytics_calculator_test.dart`\n- `test/features/rally_capture/providers/running_totals_test.dart`\n- `test/features/rally_capture/providers/player_stats_test.dart`\n- `test/features/export/csv_export_service_test.dart`\n- `test/features/rally_capture/data/rally_sync_repository_test.dart`\n- `test/features/rally_capture/substitution_logic_test.dart`\n\n## Test Examples\n\n### Analytics Calculator Tests\n```dart\ngroup('AnalyticsCalculator', () {\n  test('calculates attack efficiency correctly', () {\n    expect(AnalyticsCalculator.attackEfficiency(\n      kills: 10, \n      errors: 3, \n      attempts: 25\n    ), equals(0.28));\n  });\n  \n  test('handles zero attempts gracefully', () {\n    expect(AnalyticsCalculator.attackEfficiency(\n      kills: 0, \n      errors: 0, \n      attempts: 0\n    ), equals(0.0)); // No division by zero\n  });\n  \n  test('handles negative efficiency', () {\n    expect(AnalyticsCalculator.attackEfficiency(\n      kills: 5, \n      errors: 10, \n      attempts: 20\n    ), equals(-0.25));\n  });\n  \n  test('calculates FBK percentage', () {\n    expect(AnalyticsCalculator.fbkPercentage(\n      fbkCount: 15, \n      totalRallies: 50\n    ), equals(30.0));\n  });\n});\n```\n\n### Running Totals Tests\n```dart\ngroup('RunningTotals', () {\n  test('tracks FBK correctly', () {\n    final totals = RunningTotals.initial();\n    final updated = totals.addFBK();\n    expect(updated.fbk, equals(1));\n  });\n  \n  test('enforces substitution limit', () {\n    var totals = RunningTotals.initial();\n    for (int i = 0; i \u003c 15; i++) {\n      totals = totals.addSubstitution();\n    }\n    expect(totals.canSubstitute, equals(false));\n    expect(totals.substitutionsRemaining, equals(0));\n  });\n});\n```\n\n## Coverage Target\n- 80%+ line coverage on all calculation modules\n- 100% branch coverage on critical paths (efficiency calculations, limits)\n\n## Acceptance Criteria\n- [ ] Analytics calculator has 100% test coverage\n- [ ] Running totals provider fully tested\n- [ ] Player stats calculations verified\n- [ ] CSV export format validated\n- [ ] Edge cases covered (zeros, negatives, limits)\n- [ ] All tests pass reliably","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T22:40:10.1897838-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:40:10.1897838-05:00","dependencies":[{"issue_id":"volleyball-stats-e2t.2","depends_on_id":"volleyball-stats-e2t","type":"parent-child","created_at":"2025-12-30T22:40:10.2066666-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-e2t.3","title":"Repository Integration Tests","description":"## Objective\nCreate integration tests for all repository implementations testing real data operations.\n\n## Current State\n- 1/7 repositories tested (MatchSetupRepository in-memory only)\n- No Supabase integration tests\n- No offline repository tests\n- No cache layer tests\n\n## Repositories to Test\n1. SupabaseMatchSetupRepository (integration with real Supabase)\n2. OfflineMatchSetupRepository (local storage)\n3. CachedMatchSetupRepository (cache + fallback)\n4. RallySyncRepository (sync queue management)\n5. AuthService (authentication flows)\n6. ExportService (file generation)\n\n## Files to Create\n- `test/integration/supabase_match_setup_repository_test.dart`\n- `test/integration/offline_match_setup_repository_test.dart`\n- `test/integration/cached_match_setup_repository_test.dart`\n- `test/integration/rally_sync_repository_test.dart`\n- `test/integration/auth_service_test.dart`\n- `test/integration/export_service_test.dart`\n\n## Test Setup\n\n### Supabase Test Configuration\n```dart\n// test/integration/setup.dart\nFuture\u003cSupabaseClient\u003e createTestSupabaseClient() async {\n  final url = Platform.environment['TEST_SUPABASE_URL'];\n  final key = Platform.environment['TEST_SUPABASE_SERVICE_ROLE_KEY'];\n  \n  if (url == null || key == null) {\n    throw SkipException('Supabase credentials not configured');\n  }\n  \n  await Supabase.initialize(url: url, anonKey: key);\n  return Supabase.instance.client;\n}\n\n// Cleanup after tests\nFuture\u003cvoid\u003e cleanupTestData(SupabaseClient client, String testPrefix) async {\n  await client.from('matches')\n    .delete()\n    .like('id', '$testPrefix%');\n}\n```\n\n### Test Environment Variables\n```bash\n# Required for integration tests\nTEST_SUPABASE_URL=https://xxx.supabase.co\nTEST_SUPABASE_SERVICE_ROLE_KEY=xxx\n```\n\n## Test Cases\n\n### SupabaseMatchSetupRepository\n```dart\ngroup('SupabaseMatchSetupRepository', () {\n  late SupabaseMatchSetupRepository repository;\n  \n  setUpAll(() async {\n    final client = await createTestSupabaseClient();\n    repository = SupabaseMatchSetupRepository(client);\n  });\n  \n  test('creates and retrieves match', () async {\n    final match = createTestMatch();\n    await repository.saveMatchDraft(match);\n    \n    final retrieved = await repository.getMatchDraft(match.id);\n    expect(retrieved, isNotNull);\n    expect(retrieved!.opponent, equals(match.opponent));\n  });\n  \n  test('handles RLS policy correctly', () async {\n    // Test that user can only see their own matches\n  });\n  \n  test('handles network failure gracefully', () async {\n    // Simulate network error\n  });\n});\n```\n\n### OfflineMatchSetupRepository\n```dart\ngroup('OfflineMatchSetupRepository', () {\n  test('persists data across restarts', () async {\n    await repository.saveMatchDraft(match);\n    \n    // Simulate app restart\n    final newRepository = OfflineMatchSetupRepository();\n    final retrieved = await newRepository.getMatchDraft(match.id);\n    \n    expect(retrieved, isNotNull);\n  });\n  \n  test('handles storage full gracefully', () async {\n    // Test storage limits\n  });\n});\n```\n\n### CachedMatchSetupRepository\n```dart\ngroup('CachedMatchSetupRepository', () {\n  test('returns cached data when offline', () async {\n    // Pre-populate cache\n    await repository.saveMatchDraft(match);\n    \n    // Simulate offline\n    mockNetworkOffline();\n    \n    final retrieved = await repository.getMatchDraft(match.id);\n    expect(retrieved, isNotNull);\n  });\n  \n  test('invalidates cache on remote update', () async {\n    // Test cache invalidation\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] All repository implementations have integration tests\n- [ ] Tests run against real Supabase (skipped if no credentials)\n- [ ] Offline scenarios tested\n- [ ] Cache behavior validated\n- [ ] Error handling verified\n- [ ] Tests clean up after themselves","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T22:40:12.0619821-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:40:12.0619821-05:00","dependencies":[{"issue_id":"volleyball-stats-e2t.3","depends_on_id":"volleyball-stats-e2t","type":"parent-child","created_at":"2025-12-30T22:40:12.076545-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-e2t.4","title":"Error Scenario Tests","description":"## Objective\nCreate tests for all error scenarios to ensure graceful handling and recovery.\n\n## Error Scenarios to Test (0 currently tested)\n\n### 1. Network Failures\n- Request timeout\n- Connection refused\n- DNS resolution failure\n- Intermittent connectivity\n\n### 2. Auth Failures\n- Token expiration\n- Invalid credentials\n- Session revoked\n- Rate limiting\n\n### 3. Supabase Connection Errors\n- Service unavailable\n- RLS policy violations\n- Database constraints (unique, foreign key)\n- Query timeout\n\n### 4. Offline Data Persistence\n- Storage full\n- Corrupted data\n- Migration failures\n- Concurrent access\n\n### 5. Sync Conflicts\n- Same entity modified on multiple devices\n- Delete while editing\n- Version mismatch\n\n### 6. Invalid Data Handling\n- Malformed JSON\n- Missing required fields\n- Invalid enum values\n- Type mismatches\n\n## Files to Create\n- `test/error_scenarios/network_failure_test.dart`\n- `test/error_scenarios/auth_failure_test.dart`\n- `test/error_scenarios/supabase_error_test.dart`\n- `test/error_scenarios/offline_persistence_test.dart`\n- `test/error_scenarios/sync_conflict_test.dart`\n- `test/error_scenarios/invalid_data_test.dart`\n\n## Test Examples\n\n### Network Failure Tests\n```dart\ngroup('Network Failures', () {\n  test('handles network timeout gracefully', () async {\n    when(mockClient.from('matches').select())\n      .thenThrow(TimeoutException('Request timed out'));\n    \n    final result = await repository.fetchMatches();\n    \n    expect(result.isError, true);\n    expect(result.error, isA\u003cNetworkException\u003e());\n    expect(result.error.isRetryable, true);\n  });\n  \n  test('handles connection refused', () async {\n    when(mockClient.from('matches').select())\n      .thenThrow(SocketException('Connection refused'));\n    \n    final result = await repository.fetchMatches();\n    \n    expect(result.isError, true);\n    expect(result.error.userMessage, contains('Unable to connect'));\n  });\n  \n  test('retries on transient failure', () async {\n    var attempts = 0;\n    when(mockClient.from('matches').select()).thenAnswer((_) {\n      attempts++;\n      if (attempts \u003c 3) throw SocketException('Network error');\n      return Future.value([testMatch]);\n    });\n    \n    final result = await repository.fetchMatchesWithRetry();\n    \n    expect(result.isSuccess, true);\n    expect(attempts, equals(3));\n  });\n});\n```\n\n### Auth Failure Tests\n```dart\ngroup('Auth Failures', () {\n  test('handles token expiration', () async {\n    when(mockAuth.currentSession).thenReturn(expiredSession);\n    \n    final result = await authService.getCurrentUser();\n    \n    expect(result.isError, true);\n    expect(result.shouldRefreshToken, true);\n  });\n  \n  test('handles invalid credentials', () async {\n    when(mockAuth.signIn(email: any, password: any))\n      .thenThrow(AuthException('Invalid credentials'));\n    \n    final result = await authService.signIn('bad@email.com', 'wrong');\n    \n    expect(result.isError, true);\n    expect(result.error.userMessage, contains('incorrect'));\n  });\n});\n```\n\n### Sync Conflict Tests\n```dart\ngroup('Sync Conflicts', () {\n  test('detects concurrent modification', () async {\n    final localMatch = createMatch(updatedAt: DateTime(2024, 1, 1));\n    final remoteMatch = createMatch(updatedAt: DateTime(2024, 1, 2));\n    \n    when(mockRemote.getMatch(any)).thenReturn(remoteMatch);\n    \n    final result = await syncService.sync(localMatch);\n    \n    expect(result.hasConflict, true);\n    expect(result.conflictResolution, equals(ConflictResolution.serverWins));\n  });\n  \n  test('handles delete while editing', () async {\n    when(mockRemote.getMatch(any)).thenThrow(NotFoundException());\n    \n    final result = await syncService.sync(localMatch);\n    \n    expect(result.isError, true);\n    expect(result.error, isA\u003cEntityDeletedException\u003e());\n  });\n});\n```\n\n## Acceptance Criteria\n- [ ] All network failure scenarios tested\n- [ ] Auth error scenarios tested\n- [ ] Supabase-specific errors handled\n- [ ] Offline edge cases covered\n- [ ] Sync conflicts properly detected and resolved\n- [ ] Invalid data doesn't crash app\n- [ ] User-friendly error messages verified","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T22:40:13.799223-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:40:13.799223-05:00","dependencies":[{"issue_id":"volleyball-stats-e2t.4","depends_on_id":"volleyball-stats-e2t","type":"parent-child","created_at":"2025-12-30T22:40:13.8089128-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-e2t.5","title":"E2E Integration Tests","description":"## Objective\nCreate end-to-end integration tests covering complete user journeys through the app.\n\n## User Journeys to Test (0 currently tested)\n\n### 1. Complete Match Flow\nSetup â†’ Rally Capture â†’ Match Completion â†’ Review\n- Create new match\n- Select team and opponent\n- Configure roster\n- Capture multiple rallies\n- Complete set\n- Complete match\n- View match recap\n\n### 2. Offline â†’ Online Sync Flow\n- Start match offline\n- Capture rallies\n- Go online\n- Verify sync completes\n- Data appears on other devices\n\n### 3. Multi-Set Match Completion\n- Complete Set 1\n- Start Set 2\n- Verify running totals reset appropriately\n- Complete match with 3-1 score\n- Verify final statistics\n\n### 4. Team/Player CRUD Operations\n- Create team\n- Add players to team\n- Edit player details\n- Remove player\n- Delete team\n\n### 5. Template Creation and Reuse\n- Create roster template\n- Use template for new match\n- Modify template\n- Verify changes persist\n\n### 6. Export Workflow\n- Complete match\n- Generate CSV export\n- Verify CSV content\n- Generate PDF export\n- Verify PDF content\n\n## Files to Create\n- `integration_test/match_flow_test.dart`\n- `integration_test/offline_sync_test.dart`\n- `integration_test/multi_set_match_test.dart`\n- `integration_test/team_management_test.dart`\n- `integration_test/template_test.dart`\n- `integration_test/export_test.dart`\n- `test_driver/integration_test.dart`\n\n## Test Implementation\n\n### Match Flow E2E Test\n```dart\nvoid main() {\n  IntegrationTestWidgetsFlutterBinding.ensureInitialized();\n  \n  testWidgets('Complete match flow', (tester) async {\n    // Launch app\n    app.main();\n    await tester.pumpAndSettle();\n    \n    // Navigate to new match\n    await tester.tap(find.text('New Match'));\n    await tester.pumpAndSettle();\n    \n    // Select team\n    await tester.tap(find.text('Select Team'));\n    await tester.pumpAndSettle();\n    await tester.tap(find.text('Test Team'));\n    await tester.pumpAndSettle();\n    \n    // Enter opponent\n    await tester.enterText(find.byKey(Key('opponent_field')), 'Opponent');\n    \n    // Continue through wizard...\n    await tester.tap(find.text('Continue'));\n    await tester.pumpAndSettle();\n    \n    // Select players\n    for (final player in testPlayers.take(6)) {\n      await tester.tap(find.text(player.name));\n    }\n    \n    // Start match\n    await tester.tap(find.text('Start Match'));\n    await tester.pumpAndSettle();\n    \n    // Capture rallies\n    await tester.tap(find.text('Win'));\n    await tester.pumpAndSettle();\n    expect(find.text('1 - 0'), findsOneWidget);\n    \n    // ... complete set to 25\n    \n    // End match\n    await tester.tap(find.text('End Match'));\n    await tester.pumpAndSettle();\n    await tester.tap(find.text('Confirm'));\n    await tester.pumpAndSettle();\n    \n    // Verify on recap screen\n    expect(find.text('Match Recap'), findsOneWidget);\n    expect(find.text('3 - 1'), findsOneWidget); // Final set score\n  });\n}\n```\n\n### Running E2E Tests\n```bash\n# Run on device/emulator\nflutter test integration_test/match_flow_test.dart\n\n# Run with driver\nflutter drive \\\n  --driver=test_driver/integration_test.dart \\\n  --target=integration_test/match_flow_test.dart\n\n# Run on web\nflutter test --platform=chrome integration_test/\n```\n\n## Acceptance Criteria\n- [ ] Complete match flow works end-to-end\n- [ ] Offline sync flow verified\n- [ ] Multi-set matches work correctly\n- [ ] Team/player CRUD tested\n- [ ] Templates work correctly\n- [ ] Export generates valid files\n- [ ] Tests run in \u003c 5 minutes\n- [ ] Tests are not flaky","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T22:40:15.4939977-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:40:15.4939977-05:00","dependencies":[{"issue_id":"volleyball-stats-e2t.5","depends_on_id":"volleyball-stats-e2t","type":"parent-child","created_at":"2025-12-30T22:40:15.5036398-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-e2t.5","depends_on_id":"volleyball-stats-wts","type":"blocks","created_at":"2025-12-30T22:42:58.1826767-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-fjn","title":"Performance Optimization","description":"## Problem\nCurrent performance issues identified:\n1. More const constructors could be added (Phase 2 fixed 126, more remain)\n2. Dashboard sorting happens on every build (no memoization)\n3. No provider selectors (full provider rebuilds on any change)\n4. Expensive operations in build methods\n\nExample from set_dashboard_screen.dart:\n```dart\nWidget build(BuildContext context) {\n  final sortedPlayers = _sortPlayers(players, _sortBy); // Sorts on every build!\n  // Should use memoization or move to provider\n}\n```\n\n## Objective\nOptimize performance across the app with focus on rendering efficiency and expensive calculations.\n\n## Tasks\n1. Audit and add remaining const constructors\n2. Memoize expensive computations in dashboards\n3. Add provider selectors to reduce rebuilds\n4. Profile hot paths and optimize bottlenecks\n5. Measure and document performance improvements\n\n## Areas to Optimize\n\n### 1. Const Constructors\n```bash\n# Find missing const opportunities\nflutter analyze --no-fatal-infos 2\u003e\u00261 | grep \"prefer_const_constructors\"\n```\n\n### 2. Memoize Dashboard Calculations\n```dart\n// BEFORE - sorts on every build\nWidget build(BuildContext context) {\n  final sortedPlayers = _sortPlayers(players, _sortBy);\n}\n\n// AFTER - memoized\nlate final _memoizedSort = useMemoized(\n  () =\u003e _sortPlayers(players, _sortBy),\n  [players, _sortBy],\n);\n\nWidget build(BuildContext context) {\n  final sortedPlayers = _memoizedSort;\n}\n```\n\n### 3. Provider Selectors\n```dart\n// BEFORE - rebuilds on any match change\nfinal match = ref.watch(matchProvider);\n\n// AFTER - only rebuilds when score changes\nfinal score = ref.watch(matchProvider.select((m) =\u003e m.score));\n```\n\n### Files to Optimize\n- `lib/features/history/set_dashboard_screen.dart` - Memoize sorting\n- `lib/features/history/season_dashboard_screen.dart` - Memoize filtering\n- `lib/features/history/utils/analytics_calculator.dart` - Cache results\n- `lib/features/rally_capture/rally_capture_screen.dart` - Reduce rebuilds\n- `lib/features/rally_capture/providers.dart` - Add selectors\n\n## Performance Profiling\n\n### Using Flutter DevTools\n1. Run `flutter run --profile`\n2. Open DevTools Performance tab\n3. Record user interaction\n4. Identify:\n   - Jank frames (\u003e 16ms)\n   - Excessive rebuilds\n   - Expensive layout operations\n\n### Key Metrics to Measure\n- App launch time (target: \u003c 2 seconds)\n- Rally capture action response (target: \u003c 100ms)\n- Dashboard load time (target: \u003c 1 second)\n- List scroll performance (60fps, no jank)\n\n## Optimization Techniques\n\n### 1. RepaintBoundary\n```dart\nRepaintBoundary(\n  child: ExpensiveWidget(),\n)\n```\n\n### 2. const Widgets\n```dart\n// Mark as const where possible\nconst SizedBox(height: 8),\nconst Divider(),\n```\n\n### 3. ListView.builder\n```dart\n// Use builder for long lists\nListView.builder(\n  itemCount: items.length,\n  itemBuilder: (context, index) =\u003e ItemWidget(item: items[index]),\n)\n```\n\n### 4. Provider select()\n```dart\n// Only watch what you need\nfinal score = ref.watch(gameProvider.select((g) =\u003e g.score));\n```\n\n## Testing Performance\n```dart\ntestWidgets('Dashboard renders within budget', (tester) async {\n  await tester.pumpWidget(createTestApp(child: SetDashboardScreen()));\n  \n  final stopwatch = Stopwatch()..start();\n  await tester.pumpAndSettle();\n  stopwatch.stop();\n  \n  expect(stopwatch.elapsedMilliseconds, lessThan(1000));\n});\n```\n\n## Acceptance Criteria\n- [ ] All const constructor opportunities used\n- [ ] Dashboard sorting memoized\n- [ ] Provider selectors reduce rebuilds\n- [ ] No jank on list scrolling (60fps)\n- [ ] App launches in \u003c 2 seconds\n- [ ] Rally actions respond in \u003c 100ms\n- [ ] Performance documented and measured","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T22:41:26.9940546-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:41:26.9940546-05:00"}
{"id":"volleyball-stats-kqr","title":"Implement Named Routes with go_router","description":"## Problem\nApp has go_router configured in pubspec but uses imperative `Navigator.push()` everywhere (~15+ files). This causes:\n- No type-safe navigation\n- No deep linking support\n- Hard to test navigation\n- No browser back button support on web\n- No state restoration\n\n## Objective\nReplace all `Navigator.push()` calls with go_router's declarative navigation.\n\n## Tasks\n1. Define all app routes in go_router configuration\n2. Replace Navigator.push() with context.go()/context.push() throughout app\n3. Add deep linking support and test URL navigation\n4. Write navigation tests with go_router\n5. Test browser back button on web\n\n## Current State\n- go_router added to pubspec.yaml\n- Some basic router config exists in `lib/core/router/`\n- All screens use `Navigator.push(MaterialPageRoute(...))`\n\n## Files to Create/Modify\n\n### Create: `lib/core/router/app_router.dart`\n```dart\nfinal appRouter = GoRouter(\n  initialLocation: '/',\n  routes: [\n    GoRoute(\n      path: '/',\n      builder: (context, state) =\u003e const HomeScreen(),\n    ),\n    GoRoute(\n      path: '/match/new',\n      builder: (context, state) =\u003e const MatchSetupFlow(),\n    ),\n    GoRoute(\n      path: '/match/:matchId',\n      builder: (context, state) {\n        final matchId = state.pathParameters['matchId']!;\n        return MatchRecapScreen(matchId: matchId);\n      },\n    ),\n    GoRoute(\n      path: '/match/:matchId/capture',\n      builder: (context, state) {\n        final matchId = state.pathParameters['matchId']!;\n        return RallyCaptureScreen(matchId: matchId);\n      },\n    ),\n    GoRoute(\n      path: '/teams',\n      builder: (context, state) =\u003e const TeamListScreen(),\n      routes: [\n        GoRoute(\n          path: 'new',\n          builder: (context, state) =\u003e const TeamCreateScreen(),\n        ),\n        GoRoute(\n          path: ':teamId',\n          builder: (context, state) {\n            final teamId = state.pathParameters['teamId']!;\n            return TeamEditScreen(teamId: teamId);\n          },\n        ),\n      ],\n    ),\n    // ... more routes\n  ],\n  errorBuilder: (context, state) =\u003e ErrorScreen(error: state.error),\n);\n```\n\n### Update: All screens using Navigator.push()\n```dart\n// BEFORE\nNavigator.push(\n  context,\n  MaterialPageRoute(builder: (_) =\u003e MatchRecapScreen(matchId: id)),\n);\n\n// AFTER\ncontext.push('/match/$id');\n```\n\n## Route Structure\n```\n/                           # Home\n/match/new                  # New match setup\n/match/:matchId             # Match recap\n/match/:matchId/capture     # Rally capture\n/match/:matchId/set/:setNum # Set dashboard\n/teams                      # Team list\n/teams/new                  # Create team\n/teams/:teamId              # Edit team\n/players                    # Player list\n/history                    # Match history\n/history/season             # Season dashboard\n/export                     # Export screen\n/auth/login                 # Login\n/auth/signup                # Signup\n/settings                   # Settings\n```\n\n## Files to Update (~15 files)\n- All screen files using Navigator.push()\n- Widget files with navigation callbacks\n- Provider files that trigger navigation\n\n## Testing Requirements\n- Navigation tests using go_router_builder\n- Deep link tests (open URL â†’ correct screen)\n- Back button behavior tests\n- Nested route tests\n\n## Acceptance Criteria\n- [ ] All routes defined in go_router config\n- [ ] No Navigator.push() calls remain\n- [ ] Deep linking works (web URLs)\n- [ ] Browser back button works\n- [ ] Navigation is type-safe\n- [ ] Navigation tests pass","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T22:41:23.7531688-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:41:23.7531688-05:00"}
{"id":"volleyball-stats-wts","title":"Phase 1: Critical Fixes (P0 Blockers)","description":"Critical fixes that must be completed before production release. These are blocking issues that prevent the app from being used reliably in real volleyball matches.\n\n## Issues Addressed\n- Offline persistence not implemented (data loss on restart)\n- Rotation tracking hardcoded to 1 (breaks per-rotation stats)\n- Match completion flow incomplete (can't mark matches as done)\n- Auth guard blocks offline use (contradicts offline-first claim)\n\n## Success Criteria\n- App works fully offline with persistent data\n- Rotation tracking implemented and accurate\n- Match completion saves final scores and status\n- Users can use app without signing in\n\n## Reference\nSee agent-docs/reports/qa-remediation-plan.md for full details","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-30T22:30:45.1938926-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:45:55.2392039-05:00","closed_at":"2025-12-30T22:45:55.2392039-05:00","close_reason":"All Phase 1 critical fixes implemented per agent-docs/features implementation docs"}
{"id":"volleyball-stats-wts.1","title":"Implement Offline Persistence with Hive","description":"## Problem\nThe app claims to be \"offline-first\" but ALL data is only stored in-memory and lost on app restart. Hive is configured in pubspec.yaml but NOT USED. Users lose all match data if app crashes or restarts while offline.\n\n## Objective\nImplement persistent local storage using Hive so all match data survives app restarts and works fully offline.\n\n## Tasks\n1. Implement Hive box for matches, rallies, actions\n2. Create local-first repository layer\n3. Add sync queue with retry logic\n4. Implement conflict resolution (last-write-wins initially)\n5. Add unit tests for offline persistence\n6. Add integration tests for offlineâ†’online sync\n\n## Files to Create\n- `lib/core/persistence/hive_service.dart` - Hive initialization and box management\n- `lib/features/rally_capture/data/rally_local_repository.dart` - Local rally storage\n- `lib/core/sync/sync_service.dart` - Background sync management\n- `lib/core/sync/conflict_resolver.dart` - Conflict resolution logic\n\n## Files to Modify\n- `lib/features/match_setup/data/offline_match_setup_repository.dart` - Use Hive instead of in-memory\n- `lib/features/rally_capture/providers.dart` - Integrate local persistence\n\n## Implementation Details\n\n### Hive Box Structure\n```dart\n// Boxes to create\nHive.openBox\u003cMatchDraft\u003e('matches');\nHive.openBox\u003cRally\u003e('rallies');\nHive.openBox\u003cRallyAction\u003e('actions');\nHive.openBox\u003cSyncQueueItem\u003e('sync_queue');\n```\n\n### Sync Queue Design\n```dart\nclass SyncQueueItem {\n  final String id;\n  final String entityType;  // 'match', 'rally', 'action'\n  final String entityId;\n  final String operation;   // 'create', 'update', 'delete'\n  final Map\u003cString, dynamic\u003e data;\n  final DateTime createdAt;\n  final int retryCount;\n  final String? lastError;\n}\n```\n\n### Conflict Resolution Strategy\n- Last-write-wins for initial implementation\n- Store local timestamp and server timestamp\n- On conflict: keep newer version, log discrepancy\n- Future: allow user to choose which version to keep\n\n## Testing Requirements\n- Offline data persistence (save/load/delete)\n- Sync queue management (add, process, retry)\n- Conflict resolution scenarios\n- App restart data recovery\n- Network failure handling\n\n## Acceptance Criteria\n- [ ] Match drafts persist across app restarts\n- [ ] Rallies and actions persist across app restarts\n- [ ] Sync queue stores pending changes when offline\n- [ ] Sync queue processes when online\n- [ ] Conflicts are detected and resolved\n- [ ] No data loss on app crash\n- [ ] Tests cover all persistence scenarios","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-30T22:31:54.9115382-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:45:48.8138965-05:00","closed_at":"2025-12-30T22:45:48.8138965-05:00","close_reason":"Already implemented per agent-docs/features implementation docs","dependencies":[{"issue_id":"volleyball-stats-wts.1","depends_on_id":"volleyball-stats-wts","type":"parent-child","created_at":"2025-12-30T22:31:54.925608-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-wts.2","title":"Implement Rotation Tracking","description":"## Problem\nRotation tracking is COMPLETELY MISSING. The rotation is hardcoded to 1 everywhere:\n- `providers.dart:284`: `rotation: 1, // TODO: Get current rotation from UI state`\n- Cannot track which rotation scored points\n- Breaks per-rotation statistics mentioned in AGENTS.md\n\n## Objective\nImplement proper serve rotation tracking (1-6) with automatic advancement on side-out.\n\n## Tasks\n1. Add rotation state to `RallyCaptureSession`\n2. Implement rotation advancement on serve changes (side-out)\n3. Add rotation picker/display UI\n4. Store rotation per rally in database\n5. Update queries to aggregate stats by rotation\n6. Add unit tests for rotation logic\n7. Add widget tests for rotation UI\n\n## Files to Modify\n- `lib/features/rally_capture/models/rally_models.dart` - Add rotation to Rally model\n- `lib/features/rally_capture/providers.dart` - Add rotation state management\n- `lib/features/rally_capture/rally_capture_screen.dart` - Add rotation UI\n- Database migrations - Add rotation_number to rallies table\n\n## Implementation Details\n\n### Rotation State\n```dart\nclass RallyCaptureSession {\n  // ... existing fields\n  int currentRotation; // 1-6\n  bool isServing; // true if our team is serving\n  \n  void advanceRotation() {\n    // Advance rotation when we gain serve (side-out)\n    if (!isServing \u0026\u0026 previousRallyWeWon) {\n      currentRotation = (currentRotation % 6) + 1;\n    }\n    isServing = previousRallyWeWon;\n  }\n}\n```\n\n### Rotation UI Requirements\n- Display current rotation (1-6) prominently\n- Allow manual rotation correction (tap to set)\n- Visual indicator of who is serving\n- Rotation grid showing player positions (optional enhancement)\n\n### Rally Model Update\n```dart\nclass Rally {\n  // ... existing fields\n  final int rotation; // 1-6, which rotation we were in\n  final bool weServed; // true if we served this rally\n}\n```\n\n### Per-Rotation Statistics\n- Track FBK, wins, losses, transition points BY rotation\n- Dashboard should show rotation breakdown\n- Export should include rotation data\n\n## Testing Requirements\n- Rotation advancement logic (1â†’2â†’3â†’4â†’5â†’6â†’1)\n- Side-out triggers rotation change\n- Manual rotation correction\n- Rotation persists with rally data\n- Per-rotation stat calculations\n\n## Acceptance Criteria\n- [ ] Current rotation displays on rally capture screen\n- [ ] Rotation advances automatically on side-out\n- [ ] Can manually set rotation if needed\n- [ ] Each rally records which rotation it occurred in\n- [ ] Dashboard shows per-rotation statistics\n- [ ] CSV export includes rotation data\n- [ ] Tests cover rotation advancement logic","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-30T22:31:56.7701869-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:45:48.8244126-05:00","closed_at":"2025-12-30T22:45:48.8244126-05:00","close_reason":"Already implemented per agent-docs/features implementation docs","dependencies":[{"issue_id":"volleyball-stats-wts.2","depends_on_id":"volleyball-stats-wts","type":"parent-child","created_at":"2025-12-30T22:31:56.7861206-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-wts.3","title":"Implement Match Completion Flow","description":"## Problem\nEnd Match button shows dialog but doesn't actually save anything:\n- `rally_capture_screen.dart:191`: `// TODO: Mark match as completed in database`\n- No final score persistence\n- No match status field (in-progress vs completed)\n- Can't filter completed matches in history\n- Can't resume incomplete matches\n\n## Objective\nImplement complete match completion flow that saves final scores, marks match as complete, and allows filtering by status.\n\n## Tasks\n1. Add match status enum (in_progress, completed, cancelled)\n2. Implement End Match flow (save final score, timestamp)\n3. Add match completion database field\n4. Update history filters to show completed matches\n5. Add ability to resume incomplete matches\n6. Add tests for match completion flow\n\n## Files to Modify\n- Database migration - Add status, completed_at to matches table\n- `lib/features/rally_capture/rally_capture_screen.dart` - Implement End Match logic\n- `lib/features/match_setup/models/match_draft.dart` - Add status field\n- `lib/features/history/match_history_screen.dart` - Add status filter\n\n## Implementation Details\n\n### Match Status Enum\n```dart\nenum MatchStatus {\n  draft,        // Setup not complete\n  inProgress,   // Active match being captured\n  completed,    // Match finished normally\n  cancelled,    // Match abandoned/cancelled\n}\n```\n\n### Match Model Updates\n```dart\nclass Match {\n  // ... existing fields\n  final MatchStatus status;\n  final DateTime? completedAt;\n  final int finalOurScore;    // Final set score (e.g., 3)\n  final int finalOpponentScore; // Final set score (e.g., 1)\n  final String? notes; // Optional completion notes\n}\n```\n\n### End Match Flow\n1. Show confirmation dialog with final scores\n2. Validate set scores are complete\n3. Save match with status = completed, completedAt = now\n4. Navigate to match recap screen\n5. Clear rally capture state\n\n### Resume Match Flow\n1. History screen shows in-progress matches\n2. Tap to resume â†’ load match state\n3. Continue rally capture from where left off\n\n## Database Migration\n```sql\nALTER TABLE matches ADD COLUMN status TEXT DEFAULT 'in_progress';\nALTER TABLE matches ADD COLUMN completed_at TIMESTAMPTZ;\nALTER TABLE matches ADD COLUMN final_our_score INTEGER;\nALTER TABLE matches ADD COLUMN final_opponent_score INTEGER;\n```\n\n## Testing Requirements\n- Match completion saves correctly\n- Status field persists and filters work\n- Can resume incomplete matches\n- Completed matches can't be modified\n- End match dialog validation\n\n## Acceptance Criteria\n- [ ] End Match button saves final scores\n- [ ] Match status is set to 'completed'\n- [ ] completed_at timestamp is recorded\n- [ ] History can filter by status (in-progress vs completed)\n- [ ] Can resume in-progress matches\n- [ ] Match recap shows for completed matches\n- [ ] Tests cover completion flow","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-30T22:31:58.5906723-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:45:48.8282195-05:00","closed_at":"2025-12-30T22:45:48.8282195-05:00","close_reason":"Already implemented per agent-docs/features implementation docs","dependencies":[{"issue_id":"volleyball-stats-wts.3","depends_on_id":"volleyball-stats-wts","type":"parent-child","created_at":"2025-12-30T22:31:58.6079131-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-wts.4","title":"Fix Auth Guard for Offline Use","description":"## Problem\nAuthGuard currently BLOCKS offline usage, contradicting the \"offline-first\" architecture:\n```dart\n// AuthGuard prevents using app offline\nif (!supabaseConnected) {\n  return Scaffold(body: Text('Supabase Not Connected'));\n}\n```\nApp should work fully offline but currently requires Supabase connection to start.\n\n## Objective\nModify auth flow to allow fully offline usage while optionally syncing when online.\n\n## Tasks\n1. Modify AuthGuard to allow offline usage\n2. Add \"Sign in later\" / \"Skip\" option\n3. Cache auth state for offline access\n4. Queue auth-required operations for when online\n5. Add tests for offline auth flow\n\n## Files to Modify\n- `lib/features/auth/auth_guard.dart` - Allow offline usage\n- `lib/features/auth/auth_provider.dart` - Cache auth state\n- `lib/core/persistence/hive_service.dart` - Store auth cache\n\n## Implementation Details\n\n### Offline-First Auth Strategy\n```dart\nclass AuthGuard extends StatelessWidget {\n  @override\n  Widget build(BuildContext context) {\n    final authState = ref.watch(authProvider);\n    \n    return authState.when(\n      authenticated: (user) =\u003e child,\n      unauthenticated: () =\u003e child, // ALLOW unauthenticated use\n      loading: () =\u003e LoadingScreen(),\n      error: (e) =\u003e child, // ALLOW on error (offline)\n    );\n  }\n}\n```\n\n### Auth State Caching\n```dart\n// Cache last known auth state in Hive\nclass CachedAuthState {\n  final String? userId;\n  final String? email;\n  final DateTime lastAuthenticated;\n  final bool wasAuthenticated;\n}\n```\n\n### Sign In Later Flow\n1. Show \"Sign In\" and \"Continue Without Account\" buttons\n2. If \"Continue Without Account\": use local-only mode\n3. All data stored locally, sync disabled\n4. Prompt to sign in periodically (non-blocking)\n\n### Sync-When-Online Strategy\n- Check connectivity on app resume\n- If online + authenticated: sync pending changes\n- If online + not authenticated: prompt sign in (optional)\n- If offline: continue with local data\n\n## Testing Requirements\n- App starts without Supabase connection\n- Can use all features offline\n- Auth state persists across restarts\n- Sign in prompt is non-blocking\n- Sync works when coming online\n\n## Acceptance Criteria\n- [ ] App works without Supabase connection\n- [ ] \"Continue Without Account\" option available\n- [ ] All features work in offline mode\n- [ ] Auth state cached for quick restart\n- [ ] Can sign in later without losing data\n- [ ] Sync happens when online + authenticated\n- [ ] Tests cover offline auth scenarios","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-30T22:32:00.4444916-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:45:48.8320363-05:00","closed_at":"2025-12-30T22:45:48.8320363-05:00","close_reason":"Already implemented per agent-docs/features implementation docs","dependencies":[{"issue_id":"volleyball-stats-wts.4","depends_on_id":"volleyball-stats-wts","type":"parent-child","created_at":"2025-12-30T22:32:00.454552-05:00","created_by":"daemon"}]}
