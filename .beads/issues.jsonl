{"id":"volleyball-stats-dql","title":"Phase 11: History Dashboards \u0026 Match Analytics","description":"Build history dashboards and match analytics to help coaches review past matches, analyze performance trends, and make data-driven decisions.\n\n## Goals\n1. Match History View - Display list of completed matches with key stats\n2. Match Recap Screen - Detailed breakdown of single match with set-by-set analysis\n3. Set Dashboard - Live and historical set statistics with visual summaries\n4. Season Dashboard - Aggregate statistics across multiple matches with filters\n5. Basic Analytics - Key performance indicators (KPIs) and trends\n\n## Success Criteria\n- Coaches can view all completed matches\n- Match recap shows comprehensive statistics\n- Season dashboard displays aggregate statistics\n- Filters work correctly (date range, opponent)\n- Analytics calculations are accurate\n- Performance \u003c2s load time for match list\n- Works offline (cached match summaries)\n\n## Dependencies\n- Assumes matches are being saved to Supabase after completion\n- May need to enhance rally capture for proper match completion\n- RLS policies must allow coaches to view their own match data\n\n## Reference\nSee agent-docs/active/todos/phase-11-plan.md for full specification","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-30T22:22:27.6358226-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:22:27.6358226-05:00"}
{"id":"volleyball-stats-dql.1","title":"Match History List Screen","description":"## Objective\nCreate a screen showing all completed matches for the selected team with quick stats and filtering capabilities.\n\n## Features Required\n- List of matches sorted by date (newest first)\n- Display for each match: opponent, date, score (sets won/lost), match result\n- Quick stats per match: total rallies, FBK count, transition points\n- Filter by: date range, opponent, season\n- Search by opponent name\n- Tap to navigate to match recap screen\n\n## Files to Create\n1. `app/lib/features/history/match_history_screen.dart` - Main screen widget with list view\n2. `app/lib/features/history/models/match_summary.dart` - MatchSummary model class:\n   ```dart\n   class MatchSummary {\n     final String matchId;\n     final String opponent;\n     final DateTime matchDate;\n     final String location;\n     final int setsWon;\n     final int setsLost;\n     final int totalRallies;\n     final int totalFBK;\n     final int totalTransitionPoints;\n     final bool isWin; // true if setsWon \u003e setsLost\n   }\n   ```\n3. `app/lib/features/history/providers.dart` - Riverpod providers for history feature\n\n## Files to Modify\n1. `app/lib/features/match_setup/match_setup_landing_screen.dart` - Add \"Match History\" navigation card\n2. `app/lib/features/match_setup/data/match_setup_repository.dart` - Add `fetchMatchSummaries()` method\n3. `app/lib/core/router/app_router.dart` - Add route for match history screen\n\n## Database Queries Needed\n- Query `matches` table filtered by `team_id`\n- Join with `sets` to get set scores\n- Aggregate rally counts and action types\n- Order by `match_date` DESC\n- Support pagination for large match lists\n\n## UI/UX Requirements\n- Show skeleton loaders while fetching\n- Empty state with friendly message when no matches exist\n- Pull-to-refresh functionality\n- Clear error messages if fetch fails\n- Cache match summaries locally for offline viewing\n\n## Testing Requirements\n- Widget test for list rendering with mock data\n- Unit test for MatchSummary model serialization\n- Test filter functionality (date range, opponent)\n- Test empty state display\n- Test error state handling\n\n## Acceptance Criteria\n- [ ] Match list loads and displays correctly\n- [ ] Filters work as expected\n- [ ] Search filters matches by opponent name\n- [ ] Tapping a match navigates to recap screen\n- [ ] Works offline with cached data\n- [ ] Performance: list loads in \u003c2 seconds","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:03.2871473-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:03.2871473-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.1","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:03.3004255-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.2","title":"Match Recap Screen","description":"## Objective\nCreate a detailed view of a single match showing comprehensive statistics with set-by-set breakdown and per-player performance.\n\n## Features Required\n\n### Match Header\n- Opponent name, date, location\n- Final score (sets won/lost)\n- Match duration (if tracked)\n- Match result indicator (W/L)\n\n### Set Summary Cards\nFor each set display:\n- Score (our score - opponent score)\n- Rally count\n- FBK count\n- Transition points\n- Win/Loss indicator\n- Expandable for more details\n\n### Overall Match Stats\n- Total rallies played\n- Total First Ball Kills (FBK)\n- Total transition points\n- Substitutions used\n- Timeouts called (ours and opponent)\n\n### Per-Player Performance Table\n- Attack stats: kills, errors, attempts, efficiency\n- Block stats: blocks, block errors\n- Serve stats: aces, errors\n- Total points contributed (kills + blocks + aces)\n\n### Additional Features\n- Timeline view: rally-by-rally breakdown (collapsible/expandable)\n- Export button: generate CSV/PDF for this match\n- Share button (future enhancement)\n\n## Files to Create\n1. `app/lib/features/history/match_recap_screen.dart` - Main recap screen\n2. `app/lib/features/history/widgets/set_summary_card.dart` - Card widget for each set\n3. `app/lib/features/history/widgets/player_performance_card.dart` - Player stats table\n4. `app/lib/features/history/widgets/match_stats_summary.dart` - Overall match statistics\n5. `app/lib/features/history/widgets/rally_timeline.dart` - Optional timeline view\n\n## Files to Modify\n1. `app/lib/features/match_setup/data/match_setup_repository.dart` - Add `fetchFullMatchDetails(matchId)` method\n2. `app/lib/features/export/export_service.dart` - Add match-specific export methods\n3. `app/lib/core/router/app_router.dart` - Add route with matchId parameter\n\n## Data Models\n```dart\nclass SetSummary {\n  final int setNumber;\n  final int ourScore;\n  final int opponentScore;\n  final int rallyCount;\n  final int fbkCount;\n  final int transitionPoints;\n  final bool isWin;\n  final Duration? duration;\n}\n\nclass PlayerPerformance {\n  final String playerId;\n  final String playerName;\n  final int jerseyNumber;\n  final int kills;\n  final int errors;\n  final int attempts;\n  final double attackEfficiency; // (kills - errors) / attempts\n  final double killPercentage;   // kills / attempts\n  final int blocks;\n  final int aces;\n  final int totalPoints;         // kills + blocks + aces\n}\n```\n\n## Data Aggregation Logic\n1. Load match with all sets from repository\n2. For each set, aggregate rallies and actions\n3. Calculate per-player statistics from actions table\n4. Compute efficiency ratios:\n   - Attack efficiency = (kills - errors) / total attempts\n   - Kill percentage = kills / total attempts\n\n## UI/UX Requirements\n- Scrollable content with sticky header\n- Expandable/collapsible sections\n- Loading skeleton while data fetches\n- Clear visual hierarchy\n- Responsive layout for different screen sizes\n- Support landscape mode for detailed tables\n\n## Testing Requirements\n- Widget test for screen layout\n- Unit tests for PlayerPerformance calculations\n- Unit tests for SetSummary aggregation\n- Test export functionality\n- Test navigation from match history\n\n## Acceptance Criteria\n- [ ] Match header displays correctly\n- [ ] Set cards show accurate scores and stats\n- [ ] Player performance table shows all players\n- [ ] Efficiency calculations are accurate\n- [ ] Export generates valid CSV/PDF\n- [ ] Screen handles loading and error states\n- [ ] Works offline with cached match data","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:04.8395609-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:04.8395609-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.2","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:04.8575716-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-dql.2","depends_on_id":"volleyball-stats-dql.1","type":"blocks","created_at":"2025-12-30T22:25:20.5541958-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-dql.2","depends_on_id":"volleyball-stats-dql.5","type":"blocks","created_at":"2025-12-30T22:25:22.2338376-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.3","title":"Set Dashboard Screen","description":"## Objective\nCreate a visual dashboard showing live and historical set statistics with serve rotation summaries and point flow visualization.\n\n## Features Required\n\n### Set Overview Section\n- Current set score (our score vs opponent)\n- Rally count for current set\n- Time elapsed in set (if tracking)\n- Set number indicator (Set 1, Set 2, etc.)\n\n### Running Totals Bar\nReuse existing component from rally capture:\n- FBK count\n- Wins count\n- Losses count\n- Transition points\n\n### Serve Rotation Summary\n- Display each rotation (1-6) with serve efficiency\n- Show rotation order and player assignments\n- Visual indicator for current rotation\n- Stats per rotation: points scored, errors\n\n### Point Flow Chart\n- Visual representation of point scoring over time\n- X-axis: rally number\n- Y-axis: score differential (us - them)\n- Color coding for momentum shifts\n- Consider using `fl_chart` package\n\n### Key Moments Highlights\n- Substitutions made (who in, who out, when)\n- Timeouts called (ours and opponent)\n- Significant rallies (e.g., long rallies, big runs)\n\n### Set Comparison Panel\n- Compare current set to previous sets in match\n- Side-by-side stats comparison\n- Trend indicators (improving/declining)\n\n## Files to Create\n1. `app/lib/features/history/set_dashboard_screen.dart` - Main dashboard screen\n2. `app/lib/features/history/widgets/rotation_summary_widget.dart` - Serve rotation display\n3. `app/lib/features/history/widgets/point_flow_chart.dart` - Score progression chart\n4. `app/lib/features/history/widgets/set_comparison_widget.dart` - Set vs set comparison\n5. `app/lib/features/history/widgets/key_moments_list.dart` - Substitutions/timeouts timeline\n\n## Files to Modify\n1. `app/lib/features/rally_capture/rally_capture_screen.dart` - Add navigation button to set dashboard\n2. `app/lib/features/rally_capture/providers.dart` - Expose set-level statistics for dashboard\n3. `app/lib/core/router/app_router.dart` - Add route for set dashboard\n\n## Dependencies\n- Consider adding `fl_chart: ^0.68.0` for charts (or use simpler custom widgets)\n- Reuse running totals component from rally_capture feature\n\n## Data Requirements\n- Real-time access to current set data during live match\n- Historical set data for completed sets\n- Rally-by-rally point data for flow chart\n- Rotation data linked to rallies\n\n## UI/UX Requirements\n- Dashboard layout with cards/tiles\n- Responsive to different screen sizes\n- Real-time updates during live match (use Riverpod watch)\n- Smooth animations for score changes\n- Clear visual hierarchy\n\n## Testing Requirements\n- Widget test for dashboard layout\n- Test rotation summary display\n- Test point flow chart rendering with various data\n- Test set comparison calculations\n- Test live update functionality\n\n## Acceptance Criteria\n- [ ] Set overview shows accurate current stats\n- [ ] Rotation summary displays all 6 rotations\n- [ ] Point flow chart renders correctly\n- [ ] Key moments list shows subs and timeouts\n- [ ] Set comparison works for multiple sets\n- [ ] Dashboard updates in real-time during match\n- [ ] Accessible from rally capture screen","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:06.3584904-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:06.3584904-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.3","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:06.3660985-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.4","title":"Season Dashboard Screen","description":"## Objective\nCreate a comprehensive season dashboard showing aggregate statistics across multiple matches with filtering and trend analysis.\n\n## Features Required\n\n### Season Overview Card\n- Total matches played\n- Overall win/loss record\n- Total sets won/lost\n- Win percentage\n- Current streak (wins/losses)\n\n### Team Statistics Section\n- Total FBK across all matches\n- Average FBK per match\n- Total transition points\n- Average transition points per match\n- Total rallies played\n- Average rallies per match\n\n### Top Performers Leaderboard\nDisplay top 3-5 players in each category:\n- Most kills (total and per match average)\n- Highest attack efficiency\n- Most blocks\n- Most aces\n- Most total points contributed\n\n### Match Trends Section\nCharts showing trends over time:\n- Win/loss trend (line chart or bar chart)\n- FBK trend over matches\n- Average score differential over time\n- Performance by opponent (grouped bar chart)\n\n### Filters Panel\n- Date range picker (start date, end date)\n- Opponent filter (multi-select dropdown)\n- Season selector (if multiple seasons)\n- Match type filter (league, tournament, scrimmage - future)\n- Apply/Clear filters buttons\n\n## Files to Create\n1. `app/lib/features/history/season_dashboard_screen.dart` - Main dashboard screen\n2. `app/lib/features/history/widgets/season_overview_card.dart` - Win/loss summary\n3. `app/lib/features/history/widgets/top_performers_widget.dart` - Leaderboard display\n4. `app/lib/features/history/widgets/match_trends_chart.dart` - Trend visualizations\n5. `app/lib/features/history/widgets/season_filters.dart` - Filter controls\n6. `app/lib/features/history/models/season_stats.dart` - Season aggregate model\n7. `app/lib/features/history/providers/season_dashboard_providers.dart` - State management\n\n## Files to Modify\n1. `app/lib/features/match_setup/match_setup_landing_screen.dart` - Add \"Season Dashboard\" navigation\n2. `app/lib/features/match_setup/data/match_setup_repository.dart` - Add season aggregation methods:\n   - `fetchSeasonStats(teamId, startDate, endDate)`\n   - `fetchTopPerformers(teamId, startDate, endDate)`\n   - `fetchMatchTrends(teamId, startDate, endDate)`\n3. `app/lib/core/router/app_router.dart` - Add route for season dashboard\n\n## Data Models\n```dart\nclass SeasonStats {\n  final int matchesPlayed;\n  final int matchesWon;\n  final int matchesLost;\n  final int setsWon;\n  final int setsLost;\n  final double winPercentage;\n  final int totalFBK;\n  final double avgFBKPerMatch;\n  final int totalTransitionPoints;\n  final int totalRallies;\n  final int currentStreak; // positive = wins, negative = losses\n}\n\nclass TopPerformer {\n  final String playerId;\n  final String playerName;\n  final int jerseyNumber;\n  final int totalValue;      // total kills, blocks, etc.\n  final double avgValue;     // per-match average\n  final String category;     // 'kills', 'blocks', 'aces', 'efficiency'\n}\n\nclass MatchTrend {\n  final DateTime matchDate;\n  final String opponent;\n  final bool isWin;\n  final int fbkCount;\n  final int scoreDifferential;\n}\n```\n\n## Database Aggregation\n- Query all matches for team within date range\n- Aggregate statistics across matches (SUM, AVG)\n- Calculate per-player totals and averages\n- Group by opponent for comparison view\n- Support efficient pagination for large datasets\n\n## UI/UX Requirements\n- Dashboard layout with scrollable sections\n- Charts should be interactive (tap for details)\n- Filters should update dashboard in real-time\n- Loading states for each section independently\n- Empty states when no data matches filters\n- Responsive layout for tablet/desktop\n\n## Testing Requirements\n- Widget tests for each dashboard section\n- Unit tests for season stats calculations\n- Test filter apply/clear functionality\n- Test chart rendering with various data\n- Test empty state when no matches\n- Test performance with large dataset\n\n## Acceptance Criteria\n- [ ] Season overview shows accurate win/loss record\n- [ ] Top performers display correct rankings\n- [ ] Trend charts render correctly\n- [ ] All filters work individually and combined\n- [ ] Dashboard updates when filters change\n- [ ] Works offline with cached data\n- [ ] Performance acceptable with 50+ matches","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:07.8837426-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:07.8837426-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.4","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:07.8969774-05:00","created_by":"daemon"},{"issue_id":"volleyball-stats-dql.4","depends_on_id":"volleyball-stats-dql.5","type":"blocks","created_at":"2025-12-30T22:25:23.8408422-05:00","created_by":"daemon"}]}
{"id":"volleyball-stats-dql.5","title":"Analytics Calculator \u0026 KPIs","description":"## Objective\nImplement core analytics calculation utilities and key performance indicators (KPIs) that will be used across all dashboard screens.\n\n## KPIs to Implement\n\n### Team-Level KPIs\n1. **FBK Percentage**: (First Ball Kills / Total Rallies) × 100\n   - Measures sideout efficiency on first attack\n2. **Transition Point Percentage**: (Transition Points / Total Rallies) × 100\n   - Measures efficiency in extended rallies\n3. **Win Rate**: (Matches Won / Total Matches) × 100\n4. **Set Win Rate**: (Sets Won / Total Sets) × 100\n5. **Average Rally Length**: Total Rallies / Total Points (if tracking)\n\n### Player-Level KPIs\n1. **Attack Efficiency**: (Kills - Errors) / Total Attempts\n   - Range: -1.0 to 1.0, higher is better\n   - Elite level: \u003e 0.300\n2. **Kill Percentage**: Kills / Total Attempts × 100\n   - Measures pure kill rate without penalizing errors\n3. **Block Efficiency**: Blocks / Block Attempts (if tracking attempts)\n4. **Serve Efficiency**: (Aces - Serve Errors) / Total Serves\n5. **Points Per Set**: Total Points / Sets Played\n   - Quick measure of offensive contribution\n\n### Derived Metrics\n1. **Scoring Run Detection**: Identify runs of 3+ consecutive points\n2. **Momentum Shifts**: Score differential changes \u003e 3 points\n3. **Clutch Performance**: Stats in close sets (within 2 points at 20+)\n\n## Files to Create\n1. `app/lib/features/history/utils/analytics_calculator.dart` - Core calculation functions\n2. `app/lib/features/history/models/kpi_summary.dart` - KPI result models\n3. `app/lib/features/history/utils/trend_analyzer.dart` - Trend detection utilities\n4. `app/lib/features/history/widgets/kpi_display_card.dart` - Reusable KPI display widget\n\n## Implementation Details\n\n### analytics_calculator.dart\n```dart\nclass AnalyticsCalculator {\n  // Team KPIs\n  static double calculateFBKPercentage(int fbkCount, int totalRallies);\n  static double calculateTransitionPercentage(int transitionPoints, int totalRallies);\n  static double calculateWinRate(int matchesWon, int totalMatches);\n  \n  // Player KPIs\n  static double calculateAttackEfficiency(int kills, int errors, int attempts);\n  static double calculateKillPercentage(int kills, int attempts);\n  static double calculateServeEfficiency(int aces, int errors, int totalServes);\n  \n  // Aggregate calculations\n  static PlayerPerformance aggregatePlayerStats(List\u003cRally\u003e rallies, String playerId);\n  static SeasonStats aggregateSeasonStats(List\u003cMatch\u003e matches);\n  \n  // Helpers\n  static String formatEfficiency(double efficiency); // e.g., \".285\" or \"-.050\"\n  static String formatPercentage(double value); // e.g., \"45.2%\"\n  static Color getEfficiencyColor(double efficiency); // green/yellow/red\n}\n```\n\n### kpi_summary.dart\n```dart\nclass KPISummary {\n  final double fbkPercentage;\n  final double transitionPercentage;\n  final double winRate;\n  final double attackEfficiency;\n  final double killPercentage;\n  // ... other KPIs\n  \n  // Comparison helpers\n  bool isBetterThan(KPISummary other);\n  Map\u003cString, double\u003e getDifferences(KPISummary other);\n}\n\nclass KPIThresholds {\n  // Define what's considered good/average/poor for each KPI\n  static const double excellentAttackEfficiency = 0.300;\n  static const double goodAttackEfficiency = 0.200;\n  static const double averageAttackEfficiency = 0.100;\n  // ... etc\n}\n```\n\n### kpi_display_card.dart\nReusable widget for displaying a single KPI:\n- KPI name/label\n- Current value (formatted)\n- Trend indicator (up/down/stable arrow)\n- Color coding based on thresholds\n- Optional: comparison to previous period\n\n## Files to Modify\n1. `app/lib/features/history/match_recap_screen.dart` - Display KPIs in recap\n2. `app/lib/features/history/season_dashboard_screen.dart` - Display season KPIs\n3. `app/lib/features/rally_capture/providers.dart` - Real-time KPI calculation during match\n\n## Edge Cases to Handle\n- Division by zero (0 attempts, 0 rallies)\n- Null/missing data for optional stats\n- Partial match data (incomplete sets)\n- Very small sample sizes (flag as \"insufficient data\")\n\n## Testing Requirements\n1. **Unit Tests for All Calculations**\n   - Test with known input/output pairs\n   - Test edge cases (0 values, negative scenarios)\n   - Test boundary conditions\n   \n2. **Test Cases**\n   ```dart\n   // Attack efficiency tests\n   expect(calculateAttackEfficiency(10, 3, 25), equals(0.28));\n   expect(calculateAttackEfficiency(0, 0, 0), equals(0.0)); // no division by zero\n   expect(calculateAttackEfficiency(5, 10, 20), equals(-0.25)); // negative efficiency\n   \n   // FBK percentage tests\n   expect(calculateFBKPercentage(15, 50), equals(30.0));\n   expect(calculateFBKPercentage(0, 100), equals(0.0));\n   ```\n\n3. **Widget Tests**\n   - KPI display card renders correctly\n   - Color coding matches thresholds\n   - Trend arrows display correctly\n\n## Acceptance Criteria\n- [ ] All KPI calculations are accurate\n- [ ] Edge cases handled gracefully (no crashes)\n- [ ] KPI display widget is reusable\n- [ ] Color coding helps users quickly assess performance\n- [ ] Calculations are efficient (no performance issues)\n- [ ] 100% unit test coverage on calculator functions\n- [ ] KPIs display correctly in match recap and season dashboard","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-30T22:24:09.518097-05:00","created_by":"Mason Beard","updated_at":"2025-12-30T22:24:09.518097-05:00","dependencies":[{"issue_id":"volleyball-stats-dql.5","depends_on_id":"volleyball-stats-dql","type":"parent-child","created_at":"2025-12-30T22:24:09.5268505-05:00","created_by":"daemon"}]}
